@using Orchard.Core.Common.ViewModels
@using Orchard.Localization.Models;
@using Orchard.Localization.Services;
@using System.Globalization;

@{
    var dateId = Model._Date.Id;
    var timeId = Model._Time.Id;

    IDateLocalizationServices dateLocalizationServices = WorkContext.Resolve<IDateLocalizationServices>();

    var options = new DateLocalizationOptions();

    var invariantDate = Convert.ToDateTime(Model._Date.Value + " " + Model._Time.Value, CultureInfo.InvariantCulture);

    Model._Date.Value = dateLocalizationServices.ConvertToLocalizedDateString(invariantDate, options);
    Model._Time.Value = dateLocalizationServices.ConvertToLocalizedTimeString(invariantDate, options);

    //var dtEditor = new DateTimeEditor() {
    //    Date = dateLocalizationServices.ConvertToLocalizedDateString(invariantDate, options),
    //    Time = dateLocalizationServices.ConvertToLocalizedTimeString(invariantDate, options),
    //    ShowDate = true,
    //    ShowTime = true,
    //};
}


<div id="@Model.Id">

    <label for="@Model._Date.Id">@Model.Title</label>
    <span class="date">@Display(Model._Date)</span>
    <span class="time">@Display(Model._Time)</span>
    <span class="hint">@Model.Hint.Text</span>

</div>

@using (Script.Foot()) {

    @* Generate the localization scripts. *@
    @Display.CalendarsPickerLocalization()
    @Display.TimeEntryLocalization()

    <script type="text/javascript">
        $(function() {

            // Calendar picker and time entry.
            $("#@dateId").calendarsPicker({
                showAnim: "",
                onSelect: function (selected) {
                    if (typeof calendarsPicker_onSelect !== "undefined") {
                        calendarsPicker_onSelect(selected, this);
                    }
                },
                renderer: $.extend({}, $.calendarsPicker.themeRollerRenderer, {
                    picker: "<div {popup:start} id='ui-datepicker-div'{popup:end} class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all{inline:start} ui-datepicker-inline{inline:end}'><div class='ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all'>{link:prev}{link:today}{link:next}</div>{months}{popup:start}{popup:end}<div class='ui-helper-clearfix'></div></div>",
                    month: "<div class='ui-datepicker-group'><div class='ui-datepicker-month ui-helper-clearfix'>{monthHeader:MM yyyy}</div><table class='ui-datepicker-calendar'><thead>{weekHeader}</thead><tbody>{weeks}</tbody></table></div>"
                })
            });

            $("#@timeId").timeEntry();
        });
    </script>
}