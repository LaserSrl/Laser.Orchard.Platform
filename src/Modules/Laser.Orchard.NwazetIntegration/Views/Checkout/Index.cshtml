@using Laser.Orchard.NwazetIntegration.Models;
@using Laser.Orchard.NwazetIntegration.ViewModels;
@using Orchard.ContentManagement;

@model CheckoutViewModel
@{

    var title = Layout.Title = Model.ShippingAddressVM != null
        ? T("Checkout: Shipping & Billing Addresses")
        : T("Checkout: Billing Address");
    Script.Require("NwazetIntegration.Addresses");
    using (Script.Foot()) {
        <script type="text/javascript">
            var requiredFormat = "@T("{0} is required.")",
                required = "@T("Required information")";
        </script>
    }
}
<h1>@title</h1>
<div class="ship-errors checkout-errors"></div>
@Html.ValidationSummary()
<div class="cart-summary">
    @Display.CheckoutCartSummary(ViewModel: Model)
</div>

@using (Html.BeginFormAntiForgeryPost(
    Url.Action("Index"), FormMethod.Post, new { @id = "address-form" })) {

    if (Model.ShippingAddressVM != null) {
        <fieldset class="shipping-address">
            <legend>@T("Shipping Address")</legend>
            @Display.AddressForm(
                Prefix: "ShippingAddressVM",
                Address: Model.ShippingAddressVM,
                IncludeCountry: true,
                ListAddress:Model.ListAvailableShippingAddress)
        </fieldset>

        <fieldset class="toggle-billing">
            <input id="toggle-billing-address" type="checkbox" />
            <label for="toggle-billing-address" class="for-checkbox">@T("Bill me at the shipping address.")</label>
        </fieldset>
    }
    <fieldset class="billing-address">
        <legend>@T("Billing Address")</legend>
        @Display.AddressForm(
            Prefix: "BillingAddressVM",
            Address: Model.BillingAddressVM,
            IncludeCountry: true,
            ListAddress: Model.ListAvailableBillingAddress)
    </fieldset>
    @*VAT Number and Fiscal code*@
    var invoiceSettings = WorkContext.CurrentSite.As<EcommerceInvoiceSettingsPart>();
    if (invoiceSettings != null && invoiceSettings.EnableInvoiceRequest) {
        <fieldset class="invoice-information" id="invoice-information">
            <legend>@T("Invoice information")</legend>

            @if (!invoiceSettings.InvoiceRequestForceChoice) {
            <div class="address-input invoice-request-input">
                @Html.CheckBoxFor(m => m.BillingAddressVM.InvoiceRequest)
                @Html.LabelFor(m => m.BillingAddressVM.InvoiceRequest, T("Request invoice").Text, new { @class = "forcheckbox" })
            </div>
            }
            else {
                <input type="hidden" name="@Html.NameFor(m => m.BillingAddressVM.InvoiceRequest)" id="@Html.IdFor(m=>m.BillingAddressVM.InvoiceRequest)" value="@invoiceSettings.InvoiceRequestDefaultValue.ToString()" />
            }
            <div class="address-input fiscal-code-input">
                @Html.LabelFor(m => m.BillingAddressVM.FiscalCode, T("Fiscal code"))
                @Html.EditorFor(m => m.BillingAddressVM.FiscalCode, new { @class = "input-medium" })
                @Html.ValidationMessageFor(m => m.BillingAddressVM.FiscalCode)
            </div>
            <div class="address-input vat-number-input">
                @Html.LabelFor(m => m.BillingAddressVM.VATNumber, T("VAT number"))
                @Html.EditorFor(m => m.BillingAddressVM.VATNumber, new { @class = "input-medium" })
                @Html.ValidationMessageFor(m => m.BillingAddressVM.VATNumber)
            </div>
        </fieldset>
    }
    <label for="@Html.Id("Email")">@T("e-mail")</label>
    <input id="@Html.Id("Email")" type="text" name="@Html.Name("Email")" value="@Model.Email" class="input-large required" />
    <div class="hint">@T("Please provide an e-mail address for us to use in order to give you updates on your order.")</div>

    <label for="@Html.Id("PhonePrefix")">@T("International Phone Prefix")</label>
    <input id="@Html.Id("PhonePrefix")" type="text" name="@Html.Name("PhonePrefix")" value="@Model.PhonePrefix" class="input-large" />
    <div class="hint"> @T("Please provide an international phone prefix, For example +39 for Italy")</div>
    <label for="@Html.Id("Phone")">@T("Phone")</label>
    <input id="@Html.Id("Phone")" type="text" name="@Html.Name("Phone")" value="@Model.Phone" class="input-large" />
    <div class="hint">@T("Please provide a phone number where we can reach you in case we need additional information. This is also required when shipping to some countries.")</div>

    <label for="@Html.Id("specialInstructions")">@T("Special Instructions")</label>
    @Html.TextAreaFor(m => m.SpecialInstructions, new { rows = "6", cols = "80", @class = "input-xxlarge" })

    <div>
        <a href="@Url.Action("Index", "ShoppingCart", new { area = "Nwazet.Commerce"})">@T("Back to cart")</a>
        @*<button type="submit" id="cartButton" name="Submit" value="cart" style="padding: 10px 10px">@T("Back to cart")</button>*@
        <button type="submit" name="Submit" value="save" style="padding: 10px 10px">@T("Next")</button>
    </div>
}
