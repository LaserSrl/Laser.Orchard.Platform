(function(n){var t=function(t,i,r){var c=t.data("model-id"),o=n("#"+c,t),f=o.val(),s=t.data("prevent-tokenization")==!0,h,e,u;s&&(f=f.replace(/{{/g,"{").replace(/}}/g,"}"));h=JSON.parse(f);e=h.filter(function(n){return n.value!=i.value});r&&e.push(i);u=JSON.stringify(e);s&&(u=u.replace(/{/g,"{{").replace(/}/g,"}}"));o.val(u)},i=function(i,r,u){var e;if(i!=null){var o=this.appendTo,f=o.parents("fieldset:first"),s=n("ul.tagit",f);r=="popped"&&t(f,u,!1);e=s.tagit("tags");n(e).each(function(n,i){t(f,i,!0)})}},r=function(t,i){for(var f,r=i.label,u=0;u<i.depth;u++)r='<span class="gap">&nbsp;<\/span>'+r;return f="<li><\/li>",n(f).data("item.autocomplete",i).append(n("<a><\/a>").html(r)).appendTo(t)};n(".territories-editor").each(function(){var u=n(this).data("selected-territories"),f=n(this).data("autocomplete-url"),t=n("> ul",this).tagit({tagSource:function(t,i){var r=n(this.element).parents(".territories-editor");n.getJSON(f,{hierarchyId:r.data("hierarchy-id"),query:t.term},function(n){i(n)})},initialTags:u,triggerKeys:["enter","tab"],allowNewTags:!1,tagsChanged:i,caseSensitive:!1,minLength:2,sortable:!0}).data("ui-tagit");t.input.autocomplete().data("ui-autocomplete")._renderItem=r;t.input.autocomplete().on("autocompletefocus",function(n){n.preventDefault()})})})(jQuery);