(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n.PhotoSphereViewer={},n.THREE))})(this,function(n,t){
/*!
 * PhotoSphereViewer 5.1.6
 * @copyright 2014-2015 Jérémy Heleine
 * @copyright 2023 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */
function gt(n,t){let i=n%t;return i<0&&(i+=t),i}function gs(n){return n.reduce((n,t)=>n+t,0)}function tu(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function uo(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function fo(n,t){const i=[0,Math.PI*2,-Math.PI*2];return i.reduce((i,r)=>{const u=t-n+r;return Math.abs(u)<Math.abs(i)?u:i},Infinity)}function eo(n,t){return Math.acos(Math.cos(n.pitch)*Math.cos(t.pitch)*Math.cos(n.yaw-t.yaw)+Math.sin(n.pitch)*Math.sin(t.pitch))}function nh([t,n],[r,i]){const u=(r-t)*Math.cos((n+i)/2),f=i-n;return Math.sqrt(u*u+f*f)}function oo(n){return typeof n=="string"?n.match(/^[a-z]/i)?document.getElementById(n):document.querySelector(n):n}function li(n,t,i){i===void 0?n.classList.toggle(t):i?n.classList.add(t):i||n.classList.remove(t)}function iu(n,t){n.classList.add(...t.split(" "))}function th(n,t){n.classList.remove(...t.split(" "))}function so(n,t){let i=n;do{if(i===t)return!0;i=i.parentElement}while(i);return!1}function ru(n,t){if(!n?.matches)return null;let i=n;do{if(i.matches(t))return i;i=i.parentElement}while(i);return null}function ho(n){let i=0,r=0,t=n;while(t)i+=t.offsetLeft-t.scrollLeft+t.clientLeft,r+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:i,y:r}}function ut(n,t){return window.getComputedStyle(n,null)[t]}function uu(n){if(n.touches.length<2)return null;const t={x:n.touches[0].clientX,y:n.touches[0].clientY},i={x:n.touches[1].clientX,y:n.touches[1].clientY};return{distance:tu(t,i),angle:uo(t,i),center:{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}}function co(n){return(document.fullscreenElement||document.webkitFullscreenElement)===n}function lo(n){(n.requestFullscreen||n.webkitRequestFullscreen).call(n)}function ao(){(document.exitFullscreen||document.webkitExitFullscreen).call(document)}function ih(n){return n.replace(/[A-Z](?:(?=[^A-Z])|[A-Z]*(?=[A-Z][^A-Z]|$))/g,(n,t)=>(t>0?"-":"")+n.toLowerCase())}function fu(n,t){let i=!1;return function(...r){i||(i=!0,setTimeout(()=>{n.apply(this,r),i=!1},t))}}function eu(n){if(typeof n!="object"||n===null||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;while(Object.getPrototypeOf(t)!==null)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t}function vo(n,t){const r=t;return function i(n,t){return Array.isArray(t)?(n&&Array.isArray(n)?n.length=0:n=[],t.forEach((t,r)=>{n[r]=i(null,t)})):typeof t=="object"?((!n||Array.isArray(n))&&(n={}),Object.keys(t).forEach(u=>{typeof t[u]=="object"&&t[u]&&eu(t[u])?t[u]!==r&&(n[u]?i(n[u],t[u]):n[u]=i(null,t[u])):n[u]=t[u]})):n=t,n}(n,t)}function ni(n){return vo(null,n)}function yo(n){return!n||Object.keys(n).length===0&&n.constructor===Object}function po(n){return n===null||n===void 0}function b(...n){for(const t of n)if(!po(t))return t;return null}function wo(n,t){if(n===t)return!0;if(bo(n)&&bo(t)){if(Object.keys(n).length!==Object.keys(t).length)return!1;for(const i of Object.keys(n))if(!wo(n[i],t[i]))return!1;return!0}return!1}function bo(n){return typeof n=="object"&&n!==null}function ou(n,t){eu(n)?(t(n.initial,!0),n.promise.then(n=>t(n,!1))):t(n,!0)}function ai(n){return{initial:!n.initial,promise:n.promise.then(n=>!n)}}function su(){const n=new Error("Loading was aborted.");return n.name="AbortError",n}function ko(n){return n?.name==="AbortError"}function s(n){console.warn(`PhotoSphereViewer: ${n}`)}function vi(n){return n?[["textureX","textureY"],["yaw","pitch"]].some(([t,i])=>n[t]!==void 0&&n[i]!==void 0):!1}function k(n,t){let i=n.match("<GPano:"+t+">(.*)<\/GPano:"+t+">");if(i!==null){const n=parseInt(i[1],10);return isNaN(n)?null:n}if(i=n.match("GPano:"+t+'="(.*?)"'),i!==null){const n=parseInt(i[1],10);return isNaN(n)?null:n}return null}function rh(n){if(!n)return{x:.5,y:.5};if(typeof n=="object")return n;let t=n.toLocaleLowerCase().split(" ").slice(0,2);t.length===1&&(t=go[t[0]]?[t[0],v]:[t[0],t[0]]);const r=t[1]!=="left"&&t[1]!=="right"&&t[0]!=="top"&&t[0]!=="bottom";t=t.map(n=>go[n]||n);r||t.reverse();const i=t.join(" ").match(/^([0-9.]+)% ([0-9.]+)%$/);return i?{x:parseFloat(i[1])/100,y:parseFloat(i[2])/100}:{x:.5,y:.5}}function ts(n,{allowCenter:t,cssOrder:i}={allowCenter:true,cssOrder:true}){return n?(typeof n=="string"&&(n=n.split(" ")),n.length===1&&(n[0]===v?n=[v,v]:yi.indexOf(n[0])!==-1?n=[v,n[0]]:pi.indexOf(n[0])!==-1&&(n=[n[0],v])),n.length!==2||ns.indexOf(n[0])===-1||ns.indexOf(n[1])===-1)?(s(`Unparsable position ${n}`),null):!t&&n[0]===v&&n[1]===v?(s(`Invalid position center center`),null):(i&&!hu(n)&&(n=[n[1],n[0]]),n[1]===v&&yi.indexOf(n[0])!==-1&&(n=[v,n[0]]),n[0]===v&&pi.indexOf(n[1])!==-1&&(n=[n[1],v]),n):null}function hu(n){return pi.indexOf(n[0])!==-1&&yi.indexOf(n[1])!==-1}function is(n){let t;if(typeof n=="string"){const f=n.toString().trim();let r=parseFloat(f.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1"));const u=f.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();u.match(/(pm|per minute)$/)&&(r/=60);switch(u){case"dpm":case"degrees per minute":case"dps":case"degrees per second":t=st.MathUtils.degToRad(r);break;case"rdpm":case"radians per minute":case"rdps":case"radians per second":t=r;break;case"rpm":case"revolutions per minute":case"rps":case"revolutions per second":t=r*Math.PI*2;break;default:throw new i(`Unknown speed unit "${u}"`);}}else t=n;return t}function ft(n,t=false,r=t){let u;if(typeof n=="string"){const t=n.toLowerCase().trim().match(/^(-?[0-9]+(?:\.[0-9]*)?)(.*)$/);if(!t)throw new i(`Unknown angle "${n}"`);const r=parseFloat(t[1]),f=t[2];if(f)switch(f){case"deg":case"degs":u=st.MathUtils.degToRad(r);break;case"rad":case"rads":u=r;break;default:throw new i(`Unknown angle unit "${f}"`);}else u=r}else if(typeof n!="number"||isNaN(n))throw new i(`Unknown angle "${n}"`);else u=n;return u=gt(t?u+Math.PI:u,Math.PI*2),t?st.MathUtils.clamp(u-Math.PI,-Math.PI/(r?2:1),Math.PI/(r?2:1)):u}function cu(n){const t=new st.Texture(n);return t.needsUpdate=!0,t.minFilter=st.LinearFilter,t.generateMipmaps=!1,t}function au(n,t){lu.setFromEuler(t).invert();n.applyQuaternion(lu)}function wi(n,t){const i=function(i){if(!i)return ni(n);const r=ni({...n,...i}),u={};for(let[i,f]of Object.entries(r)){if(t&&i in t)f=t[i](f,{rawConfig:r,defValue:n[i]});else if(!(i in n)){s(`Unknown option ${i}`);continue}u[i]=f}return u};return i.defaults=n,i.parsers=t||{},i}function ls(n){if(n)for(const[,t]of[["_",n],...Object.entries(n)])if(t.prototype instanceof y)return t;return null}function uh(){const t=document.createElement("canvas");let n=null;return t.getContext?["webgl2","webgl","experimental-webgl","moz-webgl","webkit-3d"].some(i=>{try{return n=t.getContext(i),n!==null}catch(r){return!1}})?n:null:null}function fh(){let n="ontouchstart"in window||navigator.maxTouchPoints>0;fi in localStorage&&(n=localStorage[fi]==="true");const t=new Promise(t=>{const i=()=>{window.removeEventListener("mousedown",r),window.removeEventListener("touchstart",u),clearTimeout(e)},r=()=>{i(),localStorage[fi]=!1,t(!1)},u=()=>{i(),localStorage[fi]=!0,t(!0)},f=()=>{i(),localStorage[fi]=n,t(n)};window.addEventListener("mousedown",r,!1);window.addEventListener("touchstart",u,!1);const e=setTimeout(f,1e4)});return{initial:n,promise:t}}function eh(n){const t=document.createElement("canvas"),r=t.getContext("2d");for(t.width=n,t.height=n/2;t.width>1024;){r.fillStyle="white";r.fillRect(0,0,1,1);try{if(r.getImageData(0,0,1,1).data[0]>0)return t.width}catch(u){}t.width/=2;t.height/=2}throw new i("Unable to detect system capabilities");}function oh(){return"exitFullscreen"in document?"fullscreenchange":"webkitExitFullscreen"in document?"webkitfullscreenchange":null}function ah(n){let t=0;switch(n){case 0:t=90;break;case 1:t=-90;break;case 3:t=180;break;default:t=0}return p.arrow.replace("rotate(0",`rotate(${t}`)}function le(n){if(n)for(const[,t]of[["_",n],...Object.entries(n)])if(t.prototype instanceof ce)return t;return null}function ps(n,t){if(!n.id)throw new i("Button id is required");if(pr[n.id]=n,n.groupId&&(oi[n.groupId]=oi[n.groupId]||[]).push(n),t){const r=pt.navbar;switch(t){case"start":r.unshift(n.id);break;case"end":r.push(n.id);break;default:{const[u,f]=t.split(":"),e=r.indexOf(u);if(!u||!f||e===-1)throw new i(`Invalid defaultPosition ${t}`);r.splice(e+(f==="right"?1:0),0,n.id)}}}}var dr,gr,st,i,lu,pu,di,wu,gi,bu,nr,ku,o,du,tr,gu,ht,nf,ct,tf,ir,rf,d,uf,rr,ff,g,ef,ur,sf,ii,hf,lt,cf,at,lf,fr,af,vt,vf,er,yf,nt,pf,or,wf,yt,bf,sr,kf,w,gf,ri,ne,cr,as,wt,ie,re,bt,ue,fe,ee,oe,ar,se,he,vr,pr,oi;"use strict";var kr=Object.defineProperty,ws=Object.getOwnPropertyDescriptor,bs=Object.getOwnPropertyNames,ks=Object.prototype.hasOwnProperty,hi=(n,t)=>{for(var i in t)kr(n,i,{get:t[i],enumerable:!0})},ds=(n,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of bs(t))ks.call(n,u)||u===i||kr(n,u,{get:()=>t[u],enumerable:!(r=ws(t,u))||r.enumerable});return n},a=()=>t,pe={};hi(pe,{AbstractAdapter:()=>y,AbstractButton:()=>h,AbstractComponent:()=>it,AbstractConfigurablePlugin:()=>vs,AbstractPlugin:()=>ce,CONSTANTS:()=>gr,DEFAULTS:()=>pt,EquirectangularAdapter:()=>wt,PSVError:()=>i,SYSTEM:()=>f,TypedEvent:()=>os,Viewer:()=>ac,events:()=>es,registerButton:()=>ps,utils:()=>ro});dr=a();gr={};hi(gr,{ACTIONS:()=>io,ANIMATION_MIN_DURATION:()=>be,CAPTURE_EVENTS_CLASS:()=>dt,CTRLZOOM_TIMEOUT:()=>to,DBLCLICK_DELAY:()=>de,DEFAULT_TRANSITION:()=>we,EASINGS:()=>ci,ICONS:()=>p,IDS:()=>e,INERTIA_WINDOW:()=>nu,KEY_CODES:()=>u,LONGTOUCH_DELAY:()=>ge,MOVE_THRESHOLD:()=>ke,SPHERE_RADIUS:()=>ot,TWOFINGERSOVERLAY_DELAY:()=>no,VIEWER_DATA:()=>rt});var we=1500,be=500,ke=4,de=300,ge=500,no=100,to=2e3,nu=300,ot=10,rt="photoSphereViewer",dt="psv--capture-event",io=(n=>(n.ROTATE_UP="ROTATE_UP",n.ROTATE_DOWN="ROTATE_DOWN",n.ROTATE_RIGHT="ROTATE_RIGHT",n.ROTATE_LEFT="ROTATE_LEFT",n.ZOOM_IN="ZOOM_IN",n.ZOOM_OUT="ZOOM_OUT",n))(io||{}),e={MENU:"menu",TWO_FINGERS:"twoFingers",CTRL_ZOOM:"ctrlZoom",ERROR:"error",DESCRIPTION:"description"},u={Enter:"Enter",Control:"Control",Escape:"Escape",Space:" ",PageUp:"PageUp",PageDown:"PageDown",ArrowLeft:"ArrowLeft",ArrowUp:"ArrowUp",ArrowRight:"ArrowRight",ArrowDown:"ArrowDown",Delete:"Delete",Plus:"+",Minus:"-"},p={arrow:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="40 40 432 432"><g transform="rotate(0, 256, 256)"><path fill="currentColor" d="M425.23 210.55H227.39a5 5 0 01-3.53-8.53l56.56-56.57a45.5 45.5 0 000-64.28 45.15 45.15 0 00-32.13-13.3 45.15 45.15 0 00-32.14 13.3L41.32 256l174.83 174.83a45.15 45.15 0 0032.14 13.3 45.15 45.15 0 0032.13-13.3 45.5 45.5 0 000-64.28l-56.57-56.57a5 5 0 013.54-8.53h197.84c25.06 0 45.45-20.39 45.45-45.45s-20.4-45.45-45.45-45.45z"/><\/g><!-- Created by Flatart from the Noun Project --><\/svg>\n',close:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g fill="currentColor" transform=" translate(50, 50) rotate(45)"><rect x="-5" y="-65" width="10" height="130"/><rect x="-65" y="-5" width="130" height="10"/><\/g><\/svg>',download:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M83.3 35.6h-17V3H32.2v32.6H16.6l33.6 32.7 33-32.7z"/><path fill="currentColor" d="M83.3 64.2v16.3H16.6V64.2H-.1v32.6H100V64.2H83.3z"/><!--Created by Michael Zenaty from the Noun Project--><\/svg>\n',fullscreenIn:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M100 40H87.1V18.8h-21V6H100zM100 93.2H66V80.3h21.1v-21H100zM34 93.2H0v-34h12.9v21.1h21zM12.9 40H0V6h34v12.9H12.8z"/><!--Created by Garrett Knoll from the Noun Project--><\/svg>\n',fullscreenOut:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M66 7h13v21h21v13H66zM66 60.3h34v12.9H79v21H66zM0 60.3h34v34H21V73.1H0zM21 7h13v34H0V28h21z"/><!--Created by Garrett Knoll from the Noun Project--><\/svg>\n',info:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path fill="currentColor" d="M28.3 26.1c-1 2.6-1.9 4.8-2.6 7-2.5 7.4-5 14.7-7.2 22-1.3 4.4.5 7.2 4.3 7.8 1.3.2 2.8.2 4.2-.1 8.2-2 11.9-8.6 15.7-15.2l-2.2 2a18.8 18.8 0 0 1-7.4 5.2 2 2 0 0 1-1.6-.2c-.2-.1 0-1 0-1.4l.8-1.8L41.9 28c.5-1.4.9-3 .7-4.4-.2-2.6-3-4.4-6.3-4.4-8.8.2-15 4.5-19.5 11.8-.2.3-.2.6-.3 1.3 3.7-2.8 6.8-6.1 11.8-6.2z"/><circle fill="currentColor" cx="39.3" cy="9.2" r="8.2"/><!--Created by Arafat Uddin from the Noun Project--><\/svg>\n',menu:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 10 80 80"><g fill="currentColor"><circle r="10" cx="20" cy="20"/><circle r="10" cx="50" cy="20"/><circle r="10" cx="80" cy="20"/><circle r="10" cx="20" cy="50"/><circle r="10" cx="50" cy="50"/><circle r="10" cx="80" cy="50"/><circle r="10" cx="20" cy="80"/><circle r="10" cx="50" cy="80"/><circle r="10" cx="80" cy="80"/><\/g><!-- Created by Richard Kunák from the Noun Project--><\/svg>\n',zoomIn:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path fill="currentColor" d="M14.043 12.22a7.738 7.738 0 1 0-1.823 1.822l4.985 4.985c.503.504 1.32.504 1.822 0a1.285 1.285 0 0 0 0-1.822l-4.984-4.985zm-6.305 1.043a5.527 5.527 0 1 1 0-11.053 5.527 5.527 0 0 1 0 11.053z"/><path fill="currentColor" d="M8.728 4.009H6.744v2.737H4.006V8.73h2.738v2.736h1.984V8.73h2.737V6.746H8.728z"/><!--Created by Ryan Canning from the Noun Project--><\/svg>\n',zoomOut:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path fill="currentColor" d="M14.043 12.22a7.738 7.738 0 1 0-1.823 1.822l4.985 4.985c.503.504 1.32.504 1.822 0a1.285 1.285 0 0 0 0-1.822l-4.984-4.985zm-6.305 1.043a5.527 5.527 0 1 1 0-11.053 5.527 5.527 0 0 1 0 11.053z"/><path fill="currentColor" d="M4.006 6.746h7.459V8.73H4.006z"/><!--Created by Ryan Canning from the Noun Project--><\/svg>\n'},ci={linear:n=>n,inQuad:n=>n*n,outQuad:n=>n*(2-n),inOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,inCubic:n=>n*n*n,outCubic:n=>--n*n*n+1,inOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,inQuart:n=>n*n*n*n,outQuart:n=>1- --n*n*n*n,inOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,inQuint:n=>n*n*n*n*n,outQuint:n=>1+--n*n*n*n*n,inOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,inSine:n=>1-Math.cos(n*(Math.PI/2)),outSine:n=>Math.sin(n*(Math.PI/2)),inOutSine:n=>.5-.5*Math.cos(Math.PI*n),inExpo:n=>Math.pow(2,10*(n-1)),outExpo:n=>1-Math.pow(2,-10*n),inOutExpo:n=>(n=n*2-1)<0?.5*Math.pow(2,10*n):1-.5*Math.pow(2,-10*n),inCirc:n=>1-Math.sqrt(1-n*n),outCirc:n=>Math.sqrt(1-(n-1)*(n-1)),inOutCirc:n=>(n*=2)<1?.5-.5*Math.sqrt(1-n*n):.5+.5*Math.sqrt(1-(n-=2)*n)},ro={};hi(ro,{Animation:()=>ti,Dynamic:()=>bi,MultiDynamic:()=>rs,PressHandler:()=>ki,Slider:()=>fs,SliderDirection:()=>us,addClasses:()=>iu,angle:()=>uo,applyEulerInverse:()=>au,cleanCssPosition:()=>ts,clone:()=>ni,createTexture:()=>cu,cssPositionIsOrdered:()=>hu,dasherize:()=>ih,deepEqual:()=>wo,deepmerge:()=>vo,distance:()=>tu,exitFullscreen:()=>ao,firstNonNull:()=>b,getAbortError:()=>su,getAngle:()=>eo,getClosest:()=>ru,getConfigParser:()=>wi,getElement:()=>oo,getPosition:()=>ho,getShortestArc:()=>fo,getStyle:()=>ut,getTouchData:()=>uu,getXMPValue:()=>k,greatArcDistance:()=>nh,hasParent:()=>so,invertResolvableBoolean:()=>ai,isAbortError:()=>ko,isEmpty:()=>yo,isExtendedPosition:()=>vi,isFullscreenEnabled:()=>co,isNil:()=>po,isPlainObject:()=>eu,logWarn:()=>s,parseAngle:()=>ft,parsePoint:()=>rh,parseSpeed:()=>is,removeClasses:()=>th,requestFullscreen:()=>lo,resolveBoolean:()=>ou,sum:()=>gs,throttle:()=>fu,toggleClass:()=>li,wrap:()=>gt});st=a();i=(class extends Error{constructor(n){super(n);this.name="PSVError";Error.captureStackTrace?.(this,i)}});var go={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},yi=["left","center","right"],pi=["top","center","bottom"],ns=[...yi,...pi],v="center";lu=new st.Quaternion;var ti=class{constructor(n){this.easing=ci.linear;this.callbacks=[];this.resolved=!1;this.cancelled=!1;this.options=n;n?(n.easing&&(this.easing=typeof n.easing=="function"?n.easing:ci[n.easing]||ci.linear),this.delayTimeout=setTimeout(()=>{this.delayTimeout=void 0,this.animationFrame=window.requestAnimationFrame(n=>this.__run(n))},n.delay||0)):this.resolved=!0}__run(n){if(!this.cancelled){this.start||(this.start=n);const i=(n-this.start)/this.options.duration,t={};if(i<1){for(const[r,n]of Object.entries(this.options.properties))if(n){const u=n.start+(n.end-n.start)*this.easing(i);t[r]=u}this.options.onTick(t,i);this.animationFrame=window.requestAnimationFrame(n=>this.__run(n))}else{for(const[i,n]of Object.entries(this.options.properties))n&&(t[i]=n.end);this.options.onTick(t,1);this.__resolve(!0);this.animationFrame=void 0}}}__resolve(n){n?this.resolved=!0:this.cancelled=!0;this.callbacks.forEach(t=>t(n));this.callbacks.length=0}then(n){return this.resolved||this.cancelled?Promise.resolve(this.resolved).then(n):new Promise(n=>{this.callbacks.push(n)}).then(n)}cancel(){this.cancelled||this.resolved||(this.__resolve(!1),this.delayTimeout&&(window.clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0))}},vu=a(),bi=class{constructor(n,t){if(this.fn=n,this.mode=0,this.speed=0,this.speedMult=0,this.currentSpeed=0,this.target=0,this.__current=0,this.min=t.min,this.max=t.max,this.wrap=t.wrap,this.current=t.defaultValue,this.wrap&&this.min!==0)throw new i("invalid config");this.fn&&this.fn(this.current)}get current(){return this.__current}set current(n){this.__current=n}setSpeed(n){this.speed=n}goto(n,t=1){this.mode=2;this.target=this.wrap?gt(n,this.max):vu.MathUtils.clamp(n,this.min,this.max);this.speedMult=t}step(n,t=1){t===0?this.setValue(this.current+n):(this.mode!==2&&(this.target=this.current),this.goto(this.target+n,t))}roll(n=false,t=1){this.mode=1;this.target=n?-Infinity:Infinity;this.speedMult=t}stop(){this.mode=0}setValue(n){return(this.target=this.wrap?gt(n,this.max):vu.MathUtils.clamp(n,this.min,this.max),this.mode=0,this.currentSpeed=0,this.target!==this.current)?(this.current=this.target,this.fn&&this.fn(this.current),!0):!1}update(n){if(this.mode===2){this.wrap&&Math.abs(this.target-this.current)>this.max/2&&(this.current=this.current<this.target?this.current+this.max:this.current-this.max);const n=this.currentSpeed*this.currentSpeed/(this.speed*this.speedMult*4);Math.abs(this.target-this.current)<=n&&(this.mode=0)}let i=this.mode===0?0:this.speed*this.speedMult;this.target<this.current&&(i=-i);this.currentSpeed<i?this.currentSpeed=Math.min(i,this.currentSpeed+n/1e3*this.speed*this.speedMult*2):this.currentSpeed>i&&(this.currentSpeed=Math.max(i,this.currentSpeed-n/1e3*this.speed*this.speedMult*2));let t=null;return(this.current>this.target&&this.currentSpeed?t=Math.max(this.target,this.current+this.currentSpeed*n/1e3):this.current<this.target&&this.currentSpeed&&(t=Math.min(this.target,this.current+this.currentSpeed*n/1e3)),t!==null&&(t=this.wrap?gt(t,this.max):vu.MathUtils.clamp(t,this.min,this.max),t!==this.current))?(this.current=t,this.fn&&this.fn(this.current),!0):!1}},rs=class{constructor(n,t){this.fn=n;this.dynamics=t;this.fn&&this.fn(this.current)}get current(){return Object.entries(this.dynamics).reduce((n,[i,t])=>(n[i]=t.current,n),{})}setSpeed(n){for(const t of Object.values(this.dynamics))t.setSpeed(n)}goto(n,t=1){for(const[i,r]of Object.entries(n))this.dynamics[i].goto(r,t)}step(n,t=1){if(t===0)this.setValue(Object.keys(n).reduce((t,i)=>(t[i]=n[i]+this.dynamics[i].current,t),{}));else for(const[i,r]of Object.entries(n))this.dynamics[i].step(r,t)}roll(n,t=1){for(const[i,r]of Object.entries(n))this.dynamics[i].roll(r,t)}stop(){for(const n of Object.values(this.dynamics))n.stop()}setValue(n){let t=!1;for(const[i,r]of Object.entries(n))t=this.dynamics[i].setValue(r)||t;return t&&this.fn&&this.fn(this.current),t}update(n){let t=!1;for(const i of Object.values(this.dynamics))t=i.update(n)||t;return t&&this.fn&&this.fn(this.current),t}},ki=class{constructor(n=200){this.delay=n;this.time=0;this.delay=n}get pending(){return this.time!==0}down(){this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0);this.time=(new Date).getTime()}up(n){if(this.time){const t=Date.now()-this.time;t<this.delay?this.timeout=setTimeout(()=>{n(),this.timeout=void 0,this.time=0},this.delay):(n(),this.time=0)}}},us=(n=>(n.VERTICAL="VERTICAL",n.HORIZONTAL="HORIZONTAL",n))(us||{}),fs=class{constructor(n,t,i){this.container=n;this.direction=t;this.listener=i;this.mousedown=!1;this.mouseover=!1;this.container.addEventListener("click",this);this.container.addEventListener("mousedown",this);this.container.addEventListener("mouseenter",this);this.container.addEventListener("mouseleave",this);this.container.addEventListener("touchstart",this);this.container.addEventListener("mousemove",this,!0);this.container.addEventListener("touchmove",this,!0);window.addEventListener("mouseup",this);window.addEventListener("touchend",this)}get isVertical(){return this.direction==="VERTICAL"}get isHorizontal(){return this.direction==="HORIZONTAL"}destroy(){window.removeEventListener("mouseup",this);window.removeEventListener("touchend",this)}handleEvent(n){switch(n.type){case"click":n.stopPropagation();break;case"mousedown":this.__onMouseDown(n);break;case"mouseenter":this.__onMouseEnter(n);break;case"mouseleave":this.__onMouseLeave(n);break;case"touchstart":this.__onTouchStart(n);break;case"mousemove":this.__onMouseMove(n);break;case"touchmove":this.__onTouchMove(n);break;case"mouseup":this.__onMouseUp(n);break;case"touchend":this.__onTouchEnd(n)}}__onMouseDown(n){this.mousedown=!0;this.__update(n.clientX,n.clientY,!0)}__onMouseEnter(n){this.mouseover=!0;this.__update(n.clientX,n.clientY,!0)}__onTouchStart(n){this.mouseover=!0;this.mousedown=!0;const t=n.changedTouches[0];this.__update(t.clientX,t.clientY,!0)}__onMouseMove(n){(this.mousedown||this.mouseover)&&(n.stopPropagation(),this.__update(n.clientX,n.clientY,!0))}__onTouchMove(n){if(this.mousedown||this.mouseover){n.stopPropagation();const t=n.changedTouches[0];this.__update(t.clientX,t.clientY,!0)}}__onMouseUp(n){this.mousedown&&(this.mousedown=!1,this.__update(n.clientX,n.clientY,!1))}__onMouseLeave(n){this.mouseover&&(this.mouseover=!1,this.__update(n.clientX,n.clientY,!0))}__onTouchEnd(n){if(this.mousedown){this.mouseover=!1;this.mousedown=!1;const t=n.changedTouches[0];this.__update(t.clientX,t.clientY,!1)}}__update(n,t,i){const r=this.container.getBoundingClientRect(),u=this.isVertical?t:n,f=r[this.isVertical?"bottom":"left"],e=r[this.isVertical?"height":"width"],o=Math.abs((f-u)/e);this.listener({value:o,click:!i,mousedown:this.mousedown,mouseover:this.mouseover,cursor:{clientX:n,clientY:t}})}},es={};hi(es,{BeforeAnimateEvent:()=>yu,BeforeRenderEvent:()=>di,BeforeRotateEvent:()=>gi,ClickEvent:()=>nr,ConfigChangedEvent:()=>o,DoubleClickEvent:()=>tr,FullscreenEvent:()=>ht,HideNotificationEvent:()=>ct,HideOverlayEvent:()=>ir,HidePanelEvent:()=>d,HideTooltipEvent:()=>rr,KeypressEvent:()=>g,LoadProgressEvent:()=>ur,ObjectEnterEvent:()=>df,ObjectEvent:()=>hr,ObjectHoverEvent:()=>cr,ObjectLeaveEvent:()=>ri,PanoramaLoadedEvent:()=>ii,PositionUpdatedEvent:()=>lt,ReadyEvent:()=>at,RenderEvent:()=>fr,ShowNotificationEvent:()=>vt,ShowOverlayEvent:()=>er,ShowPanelEvent:()=>nt,ShowTooltipEvent:()=>or,SizeUpdatedEvent:()=>yt,StopAllEvent:()=>sr,ViewerEvent:()=>r,ZoomUpdatedEvent:()=>w});var os=class extends Event{constructor(n,t=false){super(n,{cancelable:t})}},ss=class extends EventTarget{dispatchEvent(n){return super.dispatchEvent(n)}addEventListener(n,t,i){super.addEventListener(n,t,i)}removeEventListener(n,t,i){super.removeEventListener(n,t,i)}},r=class extends os{},hs=class extends r{constructor(n,t){super(hs.type,!0);this.position=n;this.zoomLevel=t}},yu=hs;yu.type="before-animate";pu=(class extends r{constructor(n,t){super(pu.type);this.timestamp=n;this.elapsed=t}});di=pu;di.type="before-render";wu=(class extends r{constructor(n){super(wu.type,!0);this.position=n}});gi=wu;gi.type="before-rotate";bu=(class extends r{constructor(n){super(bu.type);this.data=n}});nr=bu;nr.type="click";ku=(class extends r{constructor(n){super(ku.type);this.options=n}containsOptions(...n){return n.some(n=>this.options.includes(n))}});o=ku;o.type="config-changed";du=(class extends r{constructor(n){super(du.type);this.data=n}});tr=du;tr.type="dblclick";gu=(class extends r{constructor(n){super(gu.type);this.fullscreenEnabled=n}});ht=gu;ht.type="fullscreen";nf=(class extends r{constructor(n){super(nf.type);this.notificationId=n}});ct=nf;ct.type="hide-notification";tf=(class extends r{constructor(n){super(tf.type);this.overlayId=n}});ir=tf;ir.type="hide-overlay";rf=(class extends r{constructor(n){super(rf.type);this.panelId=n}});d=rf;d.type="hide-panel";uf=(class extends r{constructor(n){super(uf.type);this.tooltipData=n}});rr=uf;rr.type="hide-tooltip";ff=(class extends r{constructor(n){super(ff.type,!0);this.key=n}});g=ff;g.type="key-press";ef=(class extends r{constructor(n){super(ef.type);this.progress=n}});ur=ef;ur.type="load-progress";sf=(class extends r{constructor(n){super(sf.type);this.data=n}});ii=sf;ii.type="panorama-loaded";hf=(class extends r{constructor(n){super(hf.type);this.position=n}});lt=hf;lt.type="position-updated";cf=(class extends r{constructor(){super(cf.type)}});at=cf;at.type="ready";lf=(class extends r{constructor(){super(lf.type)}});fr=lf;fr.type="render";af=(class extends r{constructor(n){super(af.type);this.notificationId=n}});vt=af;vt.type="show-notification";vf=(class extends r{constructor(n){super(vf.type);this.overlayId=n}});er=vf;er.type="show-overlay";yf=(class extends r{constructor(n){super(yf.type);this.panelId=n}});nt=yf;nt.type="show-panel";pf=(class extends r{constructor(n,t){super(pf.type);this.tooltip=n;this.tooltipData=t}});or=pf;or.type="show-tooltip";wf=(class extends r{constructor(n){super(wf.type);this.size=n}});yt=wf;yt.type="size-updated";bf=(class extends r{constructor(){super(bf.type)}});sr=bf;sr.type="stop-all";kf=(class extends r{constructor(n){super(kf.type);this.zoomLevel=n}});w=kf;w.type="zoom-updated";var hr=class extends r{constructor(n,t,i,r,u){super(n);this.originalEvent=t;this.object=i;this.viewerPoint=r;this.userDataKey=u}},cs=class extends hr{constructor(n,t,i,r){super(cs.type,n,t,i,r)}},df=cs;df.type="enter-object";gf=(class extends hr{constructor(n,t,i,r){super(gf.type,n,t,i,r)}});ri=gf;ri.type="leave-object";ne=(class extends hr{constructor(n,t,i,r){super(ne.type,n,t,i,r)}});cr=ne;cr.type="hover-object";var te=a(),c=class{constructor(n){this.viewer=n}destroy(){}supportsTransition(){return!1}supportsPreload(){return!1}static createOverlayMaterial({additionalUniforms:n,overrideVertexShader:t}={}){return new te.ShaderMaterial({uniforms:{...n,[c.OVERLAY_UNIFORMS.panorama]:{value:new te.Texture},[c.OVERLAY_UNIFORMS.overlay]:{value:new te.Texture},[c.OVERLAY_UNIFORMS.globalOpacity]:{value:1},[c.OVERLAY_UNIFORMS.overlayOpacity]:{value:1}},vertexShader:t||`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );
}`,fragmentShader:`
uniform sampler2D ${c.OVERLAY_UNIFORMS.panorama};
uniform sampler2D ${c.OVERLAY_UNIFORMS.overlay};
uniform float ${c.OVERLAY_UNIFORMS.globalOpacity};
uniform float ${c.OVERLAY_UNIFORMS.overlayOpacity};

varying vec2 vUv;

void main() {
  vec4 tColor1 = texture2D( ${c.OVERLAY_UNIFORMS.panorama}, vUv );
  vec4 tColor2 = texture2D( ${c.OVERLAY_UNIFORMS.overlay}, vUv );
  gl_FragColor = vec4(
    mix( tColor1.rgb, tColor2.rgb, tColor2.a * ${c.OVERLAY_UNIFORMS.overlayOpacity} ),
    ${c.OVERLAY_UNIFORMS.globalOpacity}
  );
}`})}},y=c;y.supportsDownload=!1;y.supportsOverlay=!1;y.OVERLAY_UNIFORMS={panorama:"panorama",overlay:"overlay",globalOpacity:"globalOpacity",overlayOpacity:"overlayOpacity"};var ui=a(),fi=`${rt}_touchSupport`,f={loaded:!1,pixelRatio:1,isWebGLSupported:!1,maxTextureWidth:0,isTouchEnabled:null,fullscreenEvent:null,__maxCanvasWidth:null,get maxCanvasWidth(){return this.__maxCanvasWidth===null&&(this.__maxCanvasWidth=eh(this.maxTextureWidth)),this.__maxCanvasWidth},load(){if(!this.loaded){const n=uh();this.pixelRatio=window.devicePixelRatio||1;this.isWebGLSupported=n!==null;this.maxTextureWidth=n?n.getParameter(n.MAX_TEXTURE_SIZE):0;this.isTouchEnabled=fh();this.fullscreenEvent=oh();this.loaded=!0}if(!f.isWebGLSupported)throw new i("WebGL is not supported.");if(f.maxTextureWidth===0)throw new i("Unable to detect system capabilities");}};as=wi({resolution:64,blur:!1},{resolution:n=>{if(!n||!ui.MathUtils.isPowerOfTwo(n))throw new i("EquirectangularAdapter resolution must be power of two");return n}});wt=(class extends y{constructor(n,t){super(n);this.config=as(t);this.SPHERE_SEGMENTS=this.config.resolution;this.SPHERE_HORIZONTAL_SEGMENTS=this.SPHERE_SEGMENTS/2}supportsTransition(){return!0}supportsPreload(){return!0}async loadTexture(n,t,r=this.viewer.config.useXmpData){if(typeof n!="string")return Promise.reject(new i("Invalid panorama url, are you using the right adapter?"));const o=await this.viewer.textureLoader.loadFile(n,n=>this.viewer.loader.setProgress(n)),u=r?await this.loadXMP(o):null,f=await this.viewer.textureLoader.blobToImage(o);typeof t=="function"&&(t=t(f));const e={fullWidth:b(t?.fullWidth,u?.fullWidth,f.width),fullHeight:b(t?.fullHeight,u?.fullHeight,f.height),croppedWidth:b(t?.croppedWidth,u?.croppedWidth,f.width),croppedHeight:b(t?.croppedHeight,u?.croppedHeight,f.height),croppedX:b(t?.croppedX,u?.croppedX,0),croppedY:b(t?.croppedY,u?.croppedY,0),poseHeading:b(t?.poseHeading,u?.poseHeading,0),posePitch:b(t?.posePitch,u?.posePitch,0),poseRoll:b(t?.poseRoll,u?.poseRoll,0)};(e.croppedWidth!==f.width||e.croppedHeight!==f.height)&&s(`Invalid panoData, croppedWidth and/or croppedHeight is not coherent with loaded image.
              panoData: ${e.croppedWidth}x${e.croppedHeight}, image: ${f.width}x${f.height}`);(t||u)&&e.fullWidth!==e.fullHeight*2&&s("Invalid panoData, fullWidth should be twice fullHeight");const h=this.createEquirectangularTexture(f,e);return{panorama:n,texture:h,panoData:e}}async loadXMP(n){const i=await this.loadBlobAsString(n),r=i.indexOf("<x:xmpmeta"),u=i.indexOf("<\/x:xmpmeta>"),t=i.substring(r,u);return r!==-1&&u!==-1&&t.includes("GPano:")?{fullWidth:k(t,"FullPanoWidthPixels"),fullHeight:k(t,"FullPanoHeightPixels"),croppedWidth:k(t,"CroppedAreaImageWidthPixels"),croppedHeight:k(t,"CroppedAreaImageHeightPixels"),croppedX:k(t,"CroppedAreaLeftPixels"),croppedY:k(t,"CroppedAreaTopPixels"),poseHeading:k(t,"PoseHeadingDegrees"),posePitch:k(t,"PosePitchDegrees"),poseRoll:k(t,"PoseRollDegrees")}:null}loadBlobAsString(n){return new Promise((t,i)=>{const r=new FileReader;r.onload=()=>t(r.result);r.onerror=i;r.readAsText(n)})}createEquirectangularTexture(n,t){if(this.config.blur||t.fullWidth>f.maxTextureWidth||t.croppedWidth!==t.fullWidth||t.croppedHeight!==t.fullHeight){const i=Math.min(1,f.maxCanvasWidth/t.fullWidth),r={fullWidth:t.fullWidth*i,fullHeight:t.fullHeight*i,croppedWidth:t.croppedWidth*i,croppedHeight:t.croppedHeight*i,croppedX:t.croppedX*i,croppedY:t.croppedY*i},u=document.createElement("canvas");u.width=r.fullWidth;u.height=r.fullHeight;const e=u.getContext("2d");return this.config.blur&&(e.filter=`blur(${u.width/2048}px)`),e.drawImage(n,r.croppedX,r.croppedY,r.croppedWidth,r.croppedHeight),cu(u)}return cu(n)}createMesh(n=1){const t=new ui.SphereGeometry(ot*n,this.SPHERE_SEGMENTS,this.SPHERE_HORIZONTAL_SEGMENTS,-Math.PI/2).scale(-1,1,1),i=y.createOverlayMaterial();return new ui.Mesh(t,i)}setTexture(n,t){this.__setUniform(n,y.OVERLAY_UNIFORMS.panorama,t.texture);this.setOverlay(n,null,1)}setOverlay(n,t,i){this.__setUniform(n,y.OVERLAY_UNIFORMS.overlayOpacity,i);t?this.__setUniform(n,y.OVERLAY_UNIFORMS.overlay,t.texture):this.__setUniform(n,y.OVERLAY_UNIFORMS.overlay,new ui.Texture)}setTextureOpacity(n,t){this.__setUniform(n,y.OVERLAY_UNIFORMS.globalOpacity,t);n.material.transparent=t<1}disposeTexture(n){n.texture?.dispose()}__setUniform(n,t,i){n.material.uniforms[t].value instanceof ui.Texture&&n.material.uniforms[t].value.dispose();n.material.uniforms[t].value=i}});wt.id="equirectangular";wt.supportsDownload=!0;wt.supportsOverlay=!0;var it=class{constructor(n,t){this.parent=n;this.children=[];this.container=document.createElement("div");this.state={visible:!0};this.viewer=n instanceof it?n.viewer:n;this.container.className=t.className||"";this.parent.children.push(this);this.parent.container.appendChild(this.container)}destroy(){this.parent.container.removeChild(this.container);const n=this.parent.children.indexOf(this);n!==-1&&this.parent.children.splice(n,1);this.children.slice().forEach(n=>n.destroy());this.children.length=0}toggle(n=!this.isVisible()){n?this.show():this.hide()}hide(){this.container.style.display="none";this.state.visible=!1}show(){this.container.style.display="";this.state.visible=!0}isVisible(){return this.state.visible}},sh=wi({id:null,className:null,title:null,hoverScale:!1,collapsable:!1,tabbable:!0,icon:null,iconActive:null}),h=class extends it{constructor(n,t){super(n,{className:`psv-button ${t.hoverScale?"psv-button--hover-scale":""} ${t.className||""}`});this.state={visible:!0,enabled:!0,supported:!0,collapsed:!1,active:!1,width:0};this.config=sh(t);this.config.id=this.constructor.id;t.icon&&this.__setIcon(t.icon);this.state.width=this.container.offsetWidth;this.config.title?this.container.title=this.config.title:this.id&&this.id in this.viewer.config.lang&&(this.container.title=this.viewer.config.lang[this.id]);t.tabbable&&(this.container.tabIndex=0);this.container.addEventListener("click",n=>{this.state.enabled&&this.onClick(),n.stopPropagation()});this.container.addEventListener("keydown",n=>{n.key===u.Enter&&this.state.enabled&&(this.onClick(),n.stopPropagation())})}get id(){return this.config.id}get title(){return this.container.title}get content(){return this.container.innerHTML}get width(){return this.state.width}get collapsable(){return this.config.collapsable}show(n=true){this.isVisible()||(this.state.visible=!0,this.state.collapsed||(this.container.style.display=""),n&&this.viewer.navbar.autoSize())}hide(n=true){this.isVisible()&&(this.state.visible=!1,this.container.style.display="none",n&&this.viewer.navbar.autoSize())}checkSupported(){ou(this.isSupported(),(n,t)=>{this.state&&(this.state.supported=n,t?n||this.hide():this.toggle(n))})}autoSize(){}isSupported(){return!0}toggleActive(n=!this.state.active){n!==this.state.active&&(this.state.active=n,li(this.container,"psv-button--active",this.state.active),this.config.iconActive&&this.__setIcon(this.state.active?this.config.iconActive:this.config.icon))}disable(){this.container.classList.add("psv-button--disabled");this.state.enabled=!1}enable(){this.container.classList.remove("psv-button--disabled");this.state.enabled=!0}collapse(){this.state.collapsed=!0;this.container.style.display="none"}uncollapse(){this.state.collapsed=!1;this.state.visible&&(this.container.style.display="")}__setIcon(n){this.container.innerHTML=n;iu(this.container.querySelector("svg"),"psv-button-svg")}},hh=class extends h{constructor(n,t){super(n,{className:`psv-custom-button ${t.className||""}`,hoverScale:!1,collapsable:t.collapsable!==!1,tabbable:t.tabbable!==!1,title:t.title});this.customOnClick=t.onClick;this.config.id=t.id?t.id:"psvButton-"+Math.random().toString(36).substring(2);t.content&&(this.container.innerHTML=t.content);this.state.width=this.container.offsetWidth;t.disabled&&this.disable();t.visible===!1&&this.hide()}onClick(){this.customOnClick?.(this.viewer)}},ei=class extends h{constructor(n){super(n,{className:"psv-description-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:p.info});this.mode=0;this.viewer.addEventListener(ct.type,this);this.viewer.addEventListener(vt.type,this);this.viewer.addEventListener(d.type,this);this.viewer.addEventListener(nt.type,this);this.viewer.addEventListener(o.type,this)}destroy(){this.viewer.removeEventListener(ct.type,this);this.viewer.removeEventListener(vt.type,this);this.viewer.removeEventListener(d.type,this);this.viewer.removeEventListener(nt.type,this);this.viewer.removeEventListener(o.type,this);super.destroy()}handleEvent(n){if(n instanceof o){n.containsOptions("description")&&this.autoSize(!0);return}if(this.mode){let t=!1;n instanceof ct?t=this.mode===1:n instanceof vt?t=this.mode===1&&n.notificationId!==e.DESCRIPTION:n instanceof d?t=this.mode===2:n instanceof nt&&(t=this.mode===2&&n.panelId!==e.DESCRIPTION);t&&(this.toggleActive(!1),this.mode=0)}}onClick(){this.mode?this.__close():this.__open()}hide(n){super.hide(n);this.mode&&this.__close()}autoSize(n=false){if(n){const n=this.viewer.navbar.getButton("caption",!1),t=n&&!n.isVisible(),i=!!this.viewer.config.description;t||i?this.show(!1):this.hide(!1)}}__close(){switch(this.mode){case 1:this.viewer.notification.hide(e.DESCRIPTION);break;case 2:this.viewer.panel.hide(e.DESCRIPTION)}}__open(){this.toggleActive(!0);this.viewer.config.description?(this.mode=2,this.viewer.panel.show({id:e.DESCRIPTION,content:(this.viewer.config.caption?`<p>${this.viewer.config.caption}</p>`:"")+this.viewer.config.description})):(this.mode=1,this.viewer.notification.show({id:e.DESCRIPTION,content:this.viewer.config.caption}))}};ei.id="description";ie=(class extends h{constructor(n){super(n,{className:"psv-download-button",hoverScale:!0,collapsable:!0,tabbable:!0,icon:p.download});this.viewer.addEventListener(o.type,this)}destroy(){this.viewer.removeEventListener(o.type,this);super.destroy()}handleEvent(n){n instanceof o&&n.containsOptions("downloadUrl")&&this.checkSupported()}onClick(){const n=document.createElement("a");n.href=this.viewer.config.downloadUrl||this.viewer.config.panorama;n.download=n.href.startsWith("data:")&&!this.viewer.config.downloadName?"panorama."+n.href.substring(0,n.href.indexOf(";")).split("/").pop():this.viewer.config.downloadName||n.href.split("/").pop();n.target="_blank";this.viewer.container.appendChild(n);n.click();setTimeout(()=>{this.viewer.container.removeChild(n)},100)}checkSupported(){const n=this.viewer.adapter.constructor.supportsDownload||this.viewer.config.downloadUrl;n?this.show():this.hide()}});ie.id="download";re=(class extends h{constructor(n){super(n,{className:"psv-fullscreen-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:p.fullscreenIn,iconActive:p.fullscreenOut});this.viewer.addEventListener(ht.type,this)}destroy(){this.viewer.removeEventListener(ht.type,this);super.destroy()}handleEvent(n){n instanceof ht&&this.toggleActive(n.fullscreenEnabled)}onClick(){this.viewer.toggleFullscreen()}});re.id="fullscreen";var ch="psvButton",lh=(n,t)=>`
<div class="psv-panel-menu psv-panel-menu--stripped">
  <h1 class="psv-panel-menu-title">${p.menu} ${t}</h1>
  <ul class="psv-panel-menu-list">
    ${n.map(n=>`
    <li data-psv-button="${n.id}" class="psv-panel-menu-item" tabindex="0">
      <span class="psv-panel-menu-item-icon">${n.content}</span>
      <span class="psv-panel-menu-item-label">${n.title}</span>
    </li>
    `).join("")}
  </ul>
</div>
`,lr=class extends h{constructor(n){super(n,{className:"psv-menu-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:p.menu});this.viewer.addEventListener(nt.type,this);this.viewer.addEventListener(d.type,this);super.hide()}destroy(){this.viewer.removeEventListener(nt.type,this);this.viewer.removeEventListener(d.type,this);super.destroy()}handleEvent(n){n instanceof nt?this.toggleActive(n.panelId===e.MENU):n instanceof d&&this.toggleActive(!1)}onClick(){this.state.active?this.__hideMenu():this.__showMenu()}hide(n){super.hide(n);this.__hideMenu()}show(n){super.show(n);this.state.active&&this.__showMenu()}__showMenu(){this.viewer.panel.show({id:e.MENU,content:lh(this.viewer.navbar.collapsed,this.viewer.config.lang.menu),noMargin:!0,clickHandler:n=>{const t=n?ru(n,"li"):void 0,i=t?t.dataset[ch]:void 0;i&&(this.viewer.navbar.getButton(i).onClick(),this.__hideMenu())}})}__hideMenu(){this.viewer.panel.hide(e.MENU)}};lr.id="menu";bt=(class extends h{constructor(n,t){super(n,{className:"psv-move-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:ah(t)});this.direction=t;this.handler=new ki;this.container.addEventListener("mousedown",this);this.container.addEventListener("keydown",this);this.container.addEventListener("keyup",this);this.viewer.container.addEventListener("mouseup",this);this.viewer.container.addEventListener("touchend",this)}destroy(){this.__onMouseUp();this.viewer.container.removeEventListener("mouseup",this);this.viewer.container.removeEventListener("touchend",this);super.destroy()}handleEvent(n){switch(n.type){case"mousedown":this.__onMouseDown();break;case"mouseup":this.__onMouseUp();break;case"touchend":this.__onMouseUp();break;case"keydown":n.key===u.Enter&&this.__onMouseDown();break;case"keyup":n.key===u.Enter&&this.__onMouseUp()}}onClick(){}isSupported(){return ai(f.isTouchEnabled)}__onMouseDown(){if(this.state.enabled){const n={};switch(this.direction){case 0:n.pitch=!1;break;case 1:n.pitch=!0;break;case 3:n.yaw=!1;break;default:n.yaw=!0}this.viewer.stopAll();this.viewer.dynamics.position.roll(n);this.handler.down()}}__onMouseUp(){this.state.enabled&&this.handler.up(()=>{this.viewer.dynamics.position.stop(),this.viewer.resetIdleTimer()})}});bt.groupId="move";ue=(class extends bt{constructor(n){super(n,1)}});ue.id="moveDown";fe=(class extends bt{constructor(n){super(n,2)}});fe.id="moveLeft";ee=(class extends bt{constructor(n){super(n,3)}});ee.id="moveRight";oe=(class extends bt{constructor(n){super(n,0)}});oe.id="moveUp";ar=(class extends h{constructor(n,t,i){super(n,{className:"psv-zoom-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:i});this.direction=t;this.handler=new ki;this.container.addEventListener("mousedown",this);this.container.addEventListener("keydown",this);this.container.addEventListener("keyup",this);this.viewer.container.addEventListener("mouseup",this);this.viewer.container.addEventListener("touchend",this)}destroy(){this.__onMouseUp();this.viewer.container.removeEventListener("mouseup",this);this.viewer.container.removeEventListener("touchend",this);super.destroy()}handleEvent(n){switch(n.type){case"mousedown":this.__onMouseDown();break;case"mouseup":this.__onMouseUp();break;case"touchend":this.__onMouseUp();break;case"keydown":n.key===u.Enter&&this.__onMouseDown();break;case"keyup":n.key===u.Enter&&this.__onMouseUp()}}onClick(){}isSupported(){return ai(f.isTouchEnabled)}__onMouseDown(){this.state.enabled&&(this.viewer.dynamics.zoom.roll(this.direction===1),this.handler.down())}__onMouseUp(){this.state.enabled&&this.handler.up(()=>this.viewer.dynamics.zoom.stop())}});ar.groupId="zoom";se=(class extends ar{constructor(n){super(n,0,p.zoomIn)}});se.id="zoomIn";he=(class extends ar{constructor(n){super(n,1,p.zoomOut)}});he.id="zoomOut";vr=(class extends h{constructor(n){super(n,{className:"psv-zoom-range",hoverScale:!1,collapsable:!1,tabbable:!1});this.zoomRange=document.createElement("div");this.zoomRange.className="psv-zoom-range-line";this.container.appendChild(this.zoomRange);this.zoomValue=document.createElement("div");this.zoomValue.className="psv-zoom-range-handle";this.zoomRange.appendChild(this.zoomValue);this.slider=new fs(this.container,"HORIZONTAL",n=>this.__onSliderUpdate(n));this.mediaMinWidth=parseInt(ut(this.container,"maxWidth"),10);this.viewer.addEventListener(w.type,this);this.viewer.state.ready?this.__moveZoomValue(this.viewer.getZoomLevel()):this.viewer.addEventListener(at.type,this)}destroy(){this.slider.destroy();this.viewer.removeEventListener(w.type,this);this.viewer.removeEventListener(at.type,this);super.destroy()}handleEvent(n){n instanceof w?this.__moveZoomValue(n.zoomLevel):n instanceof at&&this.__moveZoomValue(this.viewer.getZoomLevel())}onClick(){}isSupported(){return ai(f.isTouchEnabled)}autoSize(){this.state.supported&&(this.viewer.state.size.width<=this.mediaMinWidth&&this.state.visible?this.hide(!1):this.viewer.state.size.width>this.mediaMinWidth&&!this.state.visible&&this.show(!1))}__moveZoomValue(n){this.zoomValue.style.left=n/100*this.zoomRange.offsetWidth-this.zoomValue.offsetWidth/2+"px"}__onSliderUpdate(n){n.mousedown&&this.viewer.zoom(n.value*100)}});vr.id="zoomRange";vr.groupId="zoom";var yr=a(),ce=class extends ss{constructor(n){super();this.viewer=n}init(){}destroy(){}},vs=class extends ce{constructor(n,t){super(n);this.config=this.constructor.configParser(t)}setOption(n,t){this.setOptions({[n]:t})}setOptions(n){const u={...this.config,...n},i=this.constructor,t=i.configParser,f=i.readonlyOptions,r=i.id;for(let[i,e]of Object.entries(n)){if(!(i in t.defaults)){s(`${r}: Unknown option "${i}"`);continue}if(f.includes(i)){s(`${r}: Option "${i}" cannot be updated`);continue}i in t.parsers&&(e=t.parsers[i](e,{rawConfig:u,defValue:t.defaults[i]}));this.config[i]=e}}};vs.readonlyOptions=[];var pt={panorama:null,overlay:null,overlayOpacity:1,container:null,adapter:[wt,null],plugins:[],caption:null,description:null,downloadUrl:null,downloadName:null,loadingImg:null,loadingTxt:"Loading...",size:null,fisheye:0,minFov:30,maxFov:90,defaultZoomLvl:50,defaultYaw:0,defaultPitch:0,sphereCorrection:null,moveSpeed:1,zoomSpeed:1,moveInertia:!0,mousewheel:!0,mousemove:!0,mousewheelCtrlKey:!1,touchmoveTwoFingers:!1,useXmpData:!0,panoData:null,requestHeaders:null,canvasBackground:"#000",withCredentials:!1,navbar:["zoom","move","download","description","caption","fullscreen"],lang:{zoom:"Zoom",zoomOut:"Zoom out",zoomIn:"Zoom in",moveUp:"Move up",moveDown:"Move down",moveLeft:"Move left",moveRight:"Move right",download:"Download",fullscreen:"Fullscreen",menu:"Menu",close:"Close",twoFingers:"Use two fingers to navigate",ctrlZoom:"Use ctrl + scroll to zoom the image",loadError:"The panorama can't be loaded"},keyboard:"fullscreen",keyboardActions:{[u.ArrowUp]:"ROTATE_UP",[u.ArrowDown]:"ROTATE_DOWN",[u.ArrowRight]:"ROTATE_RIGHT",[u.ArrowLeft]:"ROTATE_LEFT",[u.PageUp]:"ZOOM_IN",[u.PageDown]:"ZOOM_OUT",[u.Plus]:"ZOOM_IN",[u.Minus]:"ZOOM_OUT"}},ys={panorama:"Use setPanorama method to change the panorama",panoData:"Use setPanorama method to change the panorama",overlay:"Use setOverlay method to changer the overlay",overlayOpacity:"Use setOverlay method to changer the overlay",container:"Cannot change viewer container",adapter:"Cannot change adapter",plugins:"Cannot change plugins"},ae={container:n=>{if(!n)throw new i("No value given for container.");return n},adapter:(n,{defValue:t})=>{if(n=n?Array.isArray(n)?[ls(n[0]),n[1]]:[ls(n),null]:t,!n[0])throw new i("An undefined value was given for adapter.");if(!n[0].id)throw new i(`Adapter has no id.`);return n},overlayOpacity:n=>yr.MathUtils.clamp(n,0,1),defaultYaw:n=>ft(n),defaultPitch:n=>ft(n,!0),defaultZoomLvl:n=>yr.MathUtils.clamp(n,0,100),minFov:(n,{rawConfig:t})=>(t.maxFov<n&&(s("maxFov cannot be lower than minFov"),n=t.maxFov),yr.MathUtils.clamp(n,1,179)),maxFov:(n,{rawConfig:t})=>(n<t.minFov&&(n=t.minFov),yr.MathUtils.clamp(n,1,179)),lang:n=>(Array.isArray(n.twoFingers)&&(s("lang.twoFingers must not be an array"),n.twoFingers=n.twoFingers[0]),{...pt.lang,...n}),keyboard:n=>n?typeof n=="object"?(s(`Use keyboardActions to configure the keyboard actions, keyboard option must be either true, false, 'fullscreen' or 'always'`),"fullscreen"):n==="always"?"always":"fullscreen":!1,keyboardActions:(n,{rawConfig:t})=>t.keyboard&&typeof t.keyboard=="object"?t.keyboard:n,fisheye:n=>n===!0?1:n===!1?0:n,requestHeaders:n=>n&&typeof n=="object"?()=>n:typeof n=="function"?n:null,plugins:n=>n.map((n,t)=>{if(n=Array.isArray(n)?[le(n[0]),n[1]]:[le(n),null],!n[0])throw new i(`An undefined value was given for plugin ${t}.`);if(!n[0].id)throw new i(`Plugin ${t} has no id.`);return n}),navbar:n=>n===!1?null:n===!0?ni(pt.navbar):typeof n=="string"?n.split(/[ ,]/):n},vh=wi(pt,ae),kt=class extends h{constructor(n){super(n,{className:"psv-caption",hoverScale:!1,collapsable:!1,tabbable:!0});this.contentWidth=0;this.state.width=0;this.contentElt=document.createElement("div");this.contentElt.className="psv-caption-content";this.container.appendChild(this.contentElt);this.setCaption(this.viewer.config.caption)}hide(){this.contentElt.style.display="none";this.state.visible=!1}show(){this.contentElt.style.display="";this.state.visible=!0}onClick(){}setCaption(n){this.show();this.contentElt.innerHTML=n??"";this.contentWidth=this.contentElt.innerHTML?this.contentElt.offsetWidth:0;this.autoSize()}autoSize(){this.toggle(this.container.offsetWidth>=this.contentWidth);this.__refreshButton()}__refreshButton(){this.viewer.navbar.getButton(ei.id,!1)?.autoSize(!0)}};kt.id="caption";pr={};oi={};[he,vr,se,ei,kt,ie,re,fe,ee,oe,ue].forEach(n=>ps(n));var yh=class extends it{constructor(n){super(n,{className:`psv-navbar ${dt}`});this.collapsed=[];this.state.visible=!1}show(){this.container.classList.add("psv-navbar--open");this.state.visible=!0}hide(){this.container.classList.remove("psv-navbar--open");this.state.visible=!1}setButtons(n){this.children.slice().forEach(n=>n.destroy());this.children.length=0;n.indexOf(kt.id)!==-1&&n.indexOf(ei.id)===-1&&n.splice(n.indexOf(kt.id),0,ei.id);n.forEach(n=>{typeof n=="object"?new hh(this,n):pr[n]?new pr[n](this):oi[n]?oi[n].forEach(n=>{new n(this)}):s(`Unknown button ${n}`)});new lr(this);this.children.forEach(n=>{n instanceof h&&n.checkSupported()});this.autoSize()}setCaption(n){this.children.some(t=>t instanceof kt?(t.setCaption(n),!0):!1)}getButton(n,t=true){const i=this.children.find(t=>t instanceof h&&t.id===n);return!i&&t&&s(`button "${n}" not found in the navbar`),i}autoSize(){this.children.forEach(n=>{n instanceof h&&n.autoSize()});const i=this.container.offsetWidth;let n=0;const t=[];(this.children.forEach(i=>{i.isVisible()&&i instanceof h&&(n+=i.width,i.collapsable&&t.push(i))}),n!==0)&&(i<n&&t.length>0?(t.forEach(n=>n.collapse()),this.collapsed=t,this.getButton(lr.id).show(!1)):i>=n&&this.collapsed.length>0&&(this.collapsed.forEach(n=>n.uncollapse()),this.collapsed=[],this.getButton(lr.id).hide(!1)),this.getButton(kt.id,!1)?.autoSize())}},ph=class extends it{constructor(n){super(n,{className:"psv-loader-container"});this.loader=document.createElement("div");this.loader.className="psv-loader";this.container.appendChild(this.loader);this.size=this.loader.offsetWidth;this.canvas=document.createElementNS("http://www.w3.org/2000/svg","svg");this.canvas.setAttribute("class","psv-loader-canvas");this.canvas.setAttribute("viewBox",`0 0 ${this.size} ${this.size}`);this.loader.appendChild(this.canvas);this.textColor=ut(this.loader,"color");this.color=ut(this.canvas,"color");this.border=parseInt(ut(this.loader,"outlineWidth"),10);this.thickness=parseInt(ut(this.canvas,"outlineWidth"),10);this.viewer.addEventListener(o.type,this);this.__updateContent();this.hide()}destroy(){this.viewer.removeEventListener(o.type,this);super.destroy()}handleEvent(n){n instanceof o&&n.containsOptions("loadingImg","loadingTxt")&&this.__updateContent()}setProgress(n){const r=Math.min(n,99.999)/100*Math.PI*2,t=this.size/2,u=t,f=this.thickness/2+this.border,i=(this.size-this.thickness)/2-this.border,e=Math.sin(r)*i+t,o=-Math.cos(r)*i+t,s=n>50?"1":"0";this.canvas.innerHTML=`
            <circle cx="${t}" cy="${t}" r="${t}" fill="${this.color}"/>
            <path d="M ${u} ${f} A ${i} ${i} 0 ${s} 1 ${e} ${o}" 
                  fill="none" stroke="${this.textColor}" stroke-width="${this.thickness}" stroke-linecap="round"/>
        `;this.viewer.dispatchEvent(new ur(Math.round(n)))}__updateContent(){const t=this.loader.querySelector(".psv-loader-image, .psv-loader-text");t&&this.loader.removeChild(t);let n;if(this.viewer.config.loadingImg?(n=document.createElement("img"),n.className="psv-loader-image",n.src=this.viewer.config.loadingImg):this.viewer.config.loadingTxt&&(n=document.createElement("div"),n.className="psv-loader-text",n.innerHTML=this.viewer.config.loadingTxt),n){const t=Math.round(Math.sqrt(2*Math.pow(this.size/2-this.thickness/2-this.border,2)));n.style.maxWidth=t+"px";n.style.maxHeight=t+"px";this.loader.appendChild(n)}}},wh=class extends it{constructor(n){super(n,{className:"psv-notification"});this.state={visible:!1,contentId:null,timeout:null};this.content=document.createElement("div");this.content.className="psv-notification-content";this.container.appendChild(this.content);this.content.addEventListener("click",()=>this.hide())}isVisible(n){return this.state.visible&&(!n||!this.state.contentId||this.state.contentId===n)}toggle(){throw new i("Notification cannot be toggled");}show(n){this.state.timeout&&(clearTimeout(this.state.timeout),this.state.timeout=null);typeof n=="string"&&(n={content:n});this.state.contentId=n.id||null;this.content.innerHTML=n.content;this.container.classList.add("psv-notification--visible");this.state.visible=!0;this.viewer.dispatchEvent(new vt(n.id));n.timeout&&(this.state.timeout=setTimeout(()=>this.hide(this.state.contentId),n.timeout))}hide(n){if(this.isVisible(n)){const n=this.state.contentId;this.container.classList.remove("psv-notification--visible");this.state.visible=!1;this.state.contentId=null;this.viewer.dispatchEvent(new ct(n))}}},bh=class extends it{constructor(n){super(n,{className:`psv-overlay ${dt}`});this.state={visible:!1,contentId:null,dissmisable:!0};this.image=document.createElement("div");this.image.className="psv-overlay-image";this.container.appendChild(this.image);this.title=document.createElement("div");this.title.className="psv-overlay-title";this.container.appendChild(this.title);this.text=document.createElement("div");this.text.className="psv-overlay-text";this.container.appendChild(this.text);this.container.addEventListener("click",this);this.viewer.addEventListener(g.type,this);super.hide()}destroy(){this.viewer.removeEventListener(g.type,this);super.destroy()}handleEvent(n){n.type==="click"?this.isVisible()&&this.state.dissmisable&&(this.hide(),n.stopPropagation()):n instanceof g&&this.isVisible()&&this.state.dissmisable&&n.key===u.Escape&&(this.hide(),n.preventDefault())}isVisible(n){return this.state.visible&&(!n||!this.state.contentId||this.state.contentId===n)}toggle(){throw new i("Overlay cannot be toggled");}show(n){typeof n=="string"&&(n={title:n});this.state.contentId=n.id||null;this.state.dissmisable=n.dissmisable!==!1;this.image.innerHTML=n.image||"";this.title.innerHTML=n.title||"";this.text.innerHTML=n.text||"";super.show();this.viewer.dispatchEvent(new er(n.id))}hide(n){if(this.isVisible(n)){const n=this.state.contentId;super.hide();this.state.contentId=null;this.viewer.dispatchEvent(new ir(n))}}},kh=200,ve="psv-panel-content--no-interaction",dh=class extends it{constructor(n){super(n,{className:`psv-panel ${dt}`});this.state={visible:!1,contentId:null,mouseX:0,mouseY:0,mousedown:!1,clickHandler:null,keyHandler:null,width:{}};const i=document.createElement("div");i.className="psv-panel-resizer";this.container.appendChild(i);const t=document.createElement("div");t.className="psv-panel-close-button";t.innerHTML=p.close;t.title=n.config.lang.close;this.container.appendChild(t);this.content=document.createElement("div");this.content.className="psv-panel-content";this.container.appendChild(this.content);this.container.addEventListener("wheel",n=>n.stopPropagation());t.addEventListener("click",()=>this.hide());i.addEventListener("mousedown",this);i.addEventListener("touchstart",this);this.viewer.container.addEventListener("mouseup",this);this.viewer.container.addEventListener("touchend",this);this.viewer.container.addEventListener("mousemove",this);this.viewer.container.addEventListener("touchmove",this);this.viewer.addEventListener(g.type,this)}destroy(){this.viewer.removeEventListener(g.type,this);this.viewer.container.removeEventListener("mousemove",this);this.viewer.container.removeEventListener("touchmove",this);this.viewer.container.removeEventListener("mouseup",this);this.viewer.container.removeEventListener("touchend",this);super.destroy()}handleEvent(n){switch(n.type){case"mousedown":this.__onMouseDown(n);break;case"touchstart":this.__onTouchStart(n);break;case"mousemove":this.__onMouseMove(n);break;case"touchmove":this.__onTouchMove(n);break;case"mouseup":this.__onMouseUp(n);break;case"touchend":this.__onTouchEnd(n);break;case g.type:this.__onKeyPress(n)}}isVisible(n){return this.state.visible&&(!n||!this.state.contentId||this.state.contentId===n)}toggle(){throw new i("Panel cannot be toggled");}show(n){typeof n=="string"&&(n={content:n});const t=this.isVisible(n.id);this.state.contentId=n.id||null;this.state.visible=!0;this.state.clickHandler&&(this.content.removeEventListener("click",this.state.clickHandler),this.content.removeEventListener("keydown",this.state.keyHandler),this.state.clickHandler=null,this.state.keyHandler=null);this.container.style.width=n.id&&this.state.width[n.id]?this.state.width[n.id]:n.width?n.width:null;this.content.innerHTML=n.content;this.content.scrollTop=0;this.container.classList.add("psv-panel--open");li(this.content,"psv-panel-content--no-margin",n.noMargin===!0);n.clickHandler&&(this.state.clickHandler=t=>{n.clickHandler(t.target)},this.state.keyHandler=t=>{t.key===u.Enter&&n.clickHandler(t.target)},this.content.addEventListener("click",this.state.clickHandler),this.content.addEventListener("keydown",this.state.keyHandler),t||setTimeout(()=>{this.content.querySelector("a,button,[tabindex]")?.focus()},300));this.viewer.dispatchEvent(new nt(n.id))}hide(n){if(this.isVisible(n)){const n=this.state.contentId;this.state.visible=!1;this.state.contentId=null;this.content.innerHTML=null;this.container.classList.remove("psv-panel--open");this.state.clickHandler&&(this.content.removeEventListener("click",this.state.clickHandler),this.state.clickHandler=null);this.viewer.dispatchEvent(new d(n))}}__onMouseDown(n){n.stopPropagation();this.__startResize(n.clientX,n.clientY)}__onTouchStart(n){if(n.stopPropagation(),n.touches.length===1){const t=n.touches[0];this.__startResize(t.clientX,t.clientY)}}__onMouseUp(n){this.state.mousedown&&(n.stopPropagation(),this.state.mousedown=!1,this.content.classList.remove(ve))}__onTouchEnd(n){this.state.mousedown&&(n.stopPropagation(),n.touches.length===0&&(this.state.mousedown=!1,this.content.classList.remove(ve)))}__onMouseMove(n){this.state.mousedown&&(n.stopPropagation(),this.__resize(n.clientX,n.clientY))}__onTouchMove(n){if(this.state.mousedown){const t=n.touches[0];this.__resize(t.clientX,t.clientY)}}__onKeyPress(n){this.isVisible()&&n.key===u.Escape&&(this.hide(),n.preventDefault())}__startResize(n,t){this.state.mouseX=n;this.state.mouseY=t;this.state.mousedown=!0;this.content.classList.add(ve)}__resize(n,t){const i=n,u=t,r=Math.max(kh,this.container.offsetWidth-(i-this.state.mouseX))+"px";this.state.contentId&&(this.state.width[this.state.contentId]=r);this.container.style.width=r;this.state.mouseX=i;this.state.mouseY=u}},gh=class extends it{constructor(n,t){super(n,{className:"psv-tooltip"});this.state={visible:!0,arrow:0,border:0,state:0,width:0,height:0,pos:"",config:null,data:null};this.content=document.createElement("div");this.content.className="psv-tooltip-content";this.container.appendChild(this.content);this.arrow=document.createElement("div");this.arrow.className="psv-tooltip-arrow";this.container.appendChild(this.arrow);this.container.addEventListener("transitionend",this);this.container.style.top="-1000px";this.container.style.left="-1000px";this.show(t)}handleEvent(n){n.type==="transitionend"&&this.__onTransitionEnd(n)}destroy(){delete this.state.data;super.destroy()}toggle(){throw new i("Tooltip cannot be toggled");}show(n){if(this.state.state!==0)throw new i("Initialized tooltip cannot be re-initialized");n.className&&iu(this.container,n.className);this.state.state=3;this.update(n.content,n);this.state.data=n.data;this.state.state=1;this.viewer.dispatchEvent(new or(this,this.state.data));this.__waitImages()}update(n,t){this.content.innerHTML=n;const i=this.container.getBoundingClientRect();this.state.width=i.right-i.left;this.state.height=i.bottom-i.top;this.state.arrow=parseInt(ut(this.arrow,"borderTopWidth"),10);this.state.border=parseInt(ut(this.container,"borderTopLeftRadius"),10);this.move(t??this.state.config)}move(n){if(this.state.state!==1&&this.state.state!==3)throw new i("Uninitialized tooltip cannot be moved");n.box||(n.box={width:0,height:0});this.state.config=n;const f=this.container,e=this.arrow,t={posClass:ts(n.position,{allowCenter:!1,cssOrder:!1})||["top","center"],width:this.state.width,height:this.state.height,top:0,left:0,arrowTop:0,arrowLeft:0};this.__computeTooltipPosition(t,n);let r=null,u=null;if(t.top<0?r="bottom":t.top+t.height>this.viewer.state.size.height&&(r="top"),t.left<0?u="right":t.left+t.width>this.viewer.state.size.width&&(u="left"),u||r){const i=hu(t.posClass);r&&(t.posClass[i?0:1]=r);u&&(t.posClass[i?1:0]=u);this.__computeTooltipPosition(t,n)}f.style.top=t.top+"px";f.style.left=t.left+"px";e.style.top=t.arrowTop+"px";e.style.left=t.arrowLeft+"px";const o=t.posClass.join("-");o!==this.state.pos&&(f.classList.remove(`psv-tooltip--${this.state.pos}`),this.state.pos=o,f.classList.add(`psv-tooltip--${this.state.pos}`))}hide(){this.container.classList.remove("psv-tooltip--visible");this.state.state=2;this.viewer.dispatchEvent(new rr(this.state.data))}__onTransitionEnd(n){if(n.propertyName==="transform")switch(this.state.state){case 1:this.container.classList.add("psv-tooltip--visible");this.state.state=3;break;case 2:this.state.state=0;this.destroy()}}__computeTooltipPosition(n,t){const i=this.state.arrow,f=t.top,r=n.height,e=t.left,u=n.width,o=i+this.state.border,s=t.box.width/2+i*2,h=t.box.height/2+i*2;switch(n.posClass.join("-")){case"top-left":n.top=f-h-r;n.left=e+o-u;n.arrowTop=r;n.arrowLeft=u-o-i;break;case"top-center":n.top=f-h-r;n.left=e-u/2;n.arrowTop=r;n.arrowLeft=u/2-i;break;case"top-right":n.top=f-h-r;n.left=e-o;n.arrowTop=r;n.arrowLeft=i;break;case"bottom-left":n.top=f+h;n.left=e+o-u;n.arrowTop=-i*2;n.arrowLeft=u-o-i;break;case"bottom-center":n.top=f+h;n.left=e-u/2;n.arrowTop=-i*2;n.arrowLeft=u/2-i;break;case"bottom-right":n.top=f+h;n.left=e-o;n.arrowTop=-i*2;n.arrowLeft=i;break;case"left-top":n.top=f+o-r;n.left=e-s-u;n.arrowTop=r-o-i;n.arrowLeft=u;break;case"center-left":n.top=f-r/2;n.left=e-s-u;n.arrowTop=r/2-i;n.arrowLeft=u;break;case"left-bottom":n.top=f-o;n.left=e-s-u;n.arrowTop=i;n.arrowLeft=u;break;case"right-top":n.top=f+o-r;n.left=e+s;n.arrowTop=r-o-i;n.arrowLeft=-i*2;break;case"center-right":n.top=f-r/2;n.left=e+s;n.arrowTop=r/2-i;n.arrowLeft=-i*2;break;case"right-bottom":n.top=f-o;n.left=e+s;n.arrowTop=i;n.arrowLeft=-i*2}}__waitImages(){const n=this.content.querySelectorAll("img");if(n.length>0){const t=[];n.forEach(n=>{t.push(new Promise(t=>{n.onload=t,n.onerror=t}))});Promise.all(t).then(()=>{if(this.state.state===1||this.state.state===3){const n=this.container.getBoundingClientRect();this.state.width=n.right-n.left;this.state.height=n.bottom-n.top;this.move(this.state.config)}})}}},nc='<svg xmlns="http://www.w3.org/2000/svg" viewBox="15 15 70 70"><path fill="currentColor" d="M50,16.2c-18.6,0-33.8,15.1-33.8,33.8S31.4,83.7,50,83.7S83.8,68.6,83.8,50S68.6,16.2,50,16.2z M50,80.2c-16.7,0-30.2-13.6-30.2-30.2S33.3,19.7,50,19.7S80.3,33.3,80.3,50S66.7,80.2,50,80.2z"/><rect fill="currentColor" x="48" y="31.7" width="4" height="28"/><rect fill="currentColor" x="48" y="63.2" width="4" height="5"/><!--Created by Shastry from the Noun Project--><\/svg>\n',et=a(),si=class{constructor(n){this.viewer=n;this.config=n.config;this.state=n.state}destroy(){}},tt=new et.Vector3,wr=new et.Euler(0,0,0,"ZXY"),tc=class extends si{constructor(n){super(n)}fovToZoomLevel(n){const t=Math.round((n-this.config.minFov)/(this.config.maxFov-this.config.minFov)*100);return t-2*(t-50)}zoomLevelToFov(n){return this.config.maxFov+n/100*(this.config.minFov-this.config.maxFov)}vFovToHFov(n){return et.MathUtils.radToDeg(2*Math.atan(Math.tan(et.MathUtils.degToRad(n)/2)*this.state.aspect))}speedToDuration(n,t){if(typeof n!="number"){const i=is(n);return t/Math.abs(i)*1e3}return Math.abs(n)}textureCoordsToSphericalCoords(n){const t=this.state.panoData;if(!t)throw new i("Current adapter does not support texture coordinates.");const r=(n.textureX+t.croppedX)/t.fullWidth*Math.PI*2,f=(n.textureY+t.croppedY)/t.fullHeight*Math.PI,u={yaw:r>=Math.PI?r-Math.PI:r+Math.PI,pitch:Math.PI/2-f};return wr.equals(this.viewer.renderer.panoramaPose)&&wr.equals(this.viewer.renderer.sphereCorrection)?u:(this.sphericalCoordsToVector3(u,tt),tt.applyEuler(this.viewer.renderer.panoramaPose),tt.applyEuler(this.viewer.renderer.sphereCorrection),this.vector3ToSphericalCoords(tt))}sphericalCoordsToTextureCoords(n){const t=this.state.panoData;if(!t)throw new i("Current adapter does not support texture coordinates.");wr.equals(this.viewer.renderer.panoramaPose)&&wr.equals(this.viewer.renderer.sphereCorrection)||(this.sphericalCoordsToVector3(n,tt),au(tt,this.viewer.renderer.sphereCorrection),au(tt,this.viewer.renderer.panoramaPose),n=this.vector3ToSphericalCoords(tt));const r=n.yaw/Math.PI/2*t.fullWidth,u=n.pitch/Math.PI*t.fullHeight;return{textureX:Math.round(n.yaw<Math.PI?r+t.fullWidth/2:r-t.fullWidth/2)-t.croppedX,textureY:Math.round(t.fullHeight/2-u)-t.croppedY}}sphericalCoordsToVector3(n,t){return t||(t=new et.Vector3),t.x=ot*-Math.cos(n.pitch)*Math.sin(n.yaw),t.y=ot*Math.sin(n.pitch),t.z=ot*Math.cos(n.pitch)*Math.cos(n.yaw),t}vector3ToSphericalCoords(n){const i=Math.acos(n.y/Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z)),t=Math.atan2(n.x,n.z);return{yaw:t<0?-t:Math.PI*2-t,pitch:Math.PI/2-i}}viewerCoordsToVector3(n){const t=this.viewer.renderer.getIntersections(n).filter(n=>n.object.userData[rt]);return t.length?t[0].point:null}viewerCoordsToSphericalCoords(n){const t=this.viewerCoordsToVector3(n);return t?this.vector3ToSphericalCoords(t):null}vector3ToViewerCoords(n){const t=n.clone();return t.project(this.viewer.renderer.camera),{x:Math.round((t.x+1)/2*this.state.size.width),y:Math.round((1-t.y)/2*this.state.size.height)}}sphericalCoordsToViewerCoords(n){return this.sphericalCoordsToVector3(n,tt),this.vector3ToViewerCoords(tt)}cleanPosition(n){return n.textureX!==void 0&&n.textureY!==void 0?this.textureCoordsToSphericalCoords(n):{yaw:ft(n.yaw),pitch:ft(n.pitch,!this.state.littlePlanet)}}cleanSphereCorrection(n){return{pan:ft(n?.pan||0),tilt:ft(n?.tilt||0,!0),roll:ft(n?.roll||0,!0,!1)}}cleanPanoramaPose(n){return{pan:et.MathUtils.degToRad(n?.poseHeading||0),tilt:et.MathUtils.degToRad(n?.posePitch||0),roll:et.MathUtils.degToRad(n?.poseRoll||0)}}},br=a(),ic='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M33.38 33.2a1.96 1.96 0 0 0 1.5-3.23 10.61 10.61 0 0 1 7.18-17.51c.7-.06 1.31-.49 1.61-1.12a13.02 13.02 0 0 1 11.74-7.43c7.14 0 12.96 5.8 12.96 12.9 0 3.07-1.1 6.05-3.1 8.38-.7.82-.61 2.05.21 2.76.83.7 2.07.6 2.78-.22a16.77 16.77 0 0 0 4.04-10.91C72.3 7.54 64.72 0 55.4 0a16.98 16.98 0 0 0-14.79 8.7 14.6 14.6 0 0 0-12.23 14.36c0 3.46 1.25 6.82 3.5 9.45.4.45.94.69 1.5.69m45.74 43.55a22.13 22.13 0 0 1-5.23 12.4c-4 4.55-9.53 6.86-16.42 6.86-12.6 0-20.1-10.8-20.17-10.91a1.82 1.82 0 0 0-.08-.1c-5.3-6.83-14.55-23.82-17.27-28.87-.05-.1 0-.21.02-.23a6.3 6.3 0 0 1 8.24 1.85l9.38 12.59a1.97 1.97 0 0 0 3.54-1.17V25.34a4 4 0 0 1 1.19-2.87 3.32 3.32 0 0 1 2.4-.95c1.88.05 3.4 1.82 3.4 3.94v24.32a1.96 1.96 0 0 0 3.93 0v-33.1a3.5 3.5 0 0 1 7 0v35.39a1.96 1.96 0 0 0 3.93 0v-.44c.05-2.05 1.6-3.7 3.49-3.7 1.93 0 3.5 1.7 3.5 3.82v5.63c0 .24.04.48.13.71l.1.26a1.97 1.97 0 0 0 3.76-.37c.33-1.78 1.77-3.07 3.43-3.07 1.9 0 3.45 1.67 3.5 3.74l-1.77 18.1zM77.39 51c-1.25 0-2.45.32-3.5.9v-.15c0-4.27-3.33-7.74-7.42-7.74-1.26 0-2.45.33-3.5.9V16.69a7.42 7.42 0 0 0-14.85 0v1.86a7 7 0 0 0-3.28-.94 7.21 7.21 0 0 0-5.26 2.07 7.92 7.92 0 0 0-2.38 5.67v37.9l-5.83-7.82a10.2 10.2 0 0 0-13.35-2.92 4.1 4.1 0 0 0-1.53 5.48C20 64.52 28.74 80.45 34.07 87.34c.72 1.04 9.02 12.59 23.4 12.59 7.96 0 14.66-2.84 19.38-8.2a26.06 26.06 0 0 0 6.18-14.6l1.78-18.2v-.2c0-4.26-3.32-7.73-7.42-7.73z"/><!--Created by AomAm from the Noun Project--><\/svg>\n',rc='<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 17 79 79"><path fill="currentColor" d="M38.1 29.27c-.24 0-.44.2-.44.45v10.7a.45.45 0 00.9 0v-10.7c0-.25-.2-.45-.45-.45zm10.2 26.66a11.54 11.54 0 01-8.48-6.14.45.45 0 10-.8.41 12.45 12.45 0 009.22 6.62.45.45 0 00.07-.9zm24.55-13.08a23.04 23.04 0 00-22.56-23v7.07l-.01.05a2.83 2.83 0 012.39 2.78v14.03l.09-.02h8.84v-9.22a.45.45 0 11.9 0v9.22h10.35v-.9zm0 27.33V44.66H62.5c-.02 2.01-.52 4-1.47 5.76a.45.45 0 01-.61.18.45.45 0 01-.19-.61 11.54 11.54 0 001.36-5.33h-8.83l-.1-.01a2.83 2.83 0 01-2.83 2.84h-.04-.04a2.83 2.83 0 01-2.83-2.83v-14.9a2.82 2.82 0 012.47-2.8v-7.11a23.04 23.04 0 00-22.57 23v.91h14.72V29.88a8.2 8.2 0 015.02-7.57c.22-.1.5.01.59.24.1.23-.01.5-.24.6a7.3 7.3 0 00-4.47 6.73v13.88h3.9a.45.45 0 110 .9h-3.9v.15a7.32 7.32 0 0011.23 6.17.45.45 0 01.49.76 8.22 8.22 0 01-12.62-6.93v-.15H26.82v25.52a23.04 23.04 0 0023.01 23.01 23.04 23.04 0 0023.02-23.01zm1.8-27.33v27.33A24.85 24.85 0 0149.84 95a24.85 24.85 0 01-24.82-24.82V42.85a24.85 24.85 0 0124.82-24.82 24.85 24.85 0 0124.83 24.82zM57.98 29.88v9.36a.45.45 0 11-.9 0v-9.36a7.28 7.28 0 00-3.4-6.17.45.45 0 01.49-.76 8.18 8.18 0 013.8 6.93z"/><!-- Created by Icon Island from the Noun Project --><\/svg>\n',uc=class extends si{constructor(n){super(n);this.data={step:0,startMouseX:0,startMouseY:0,mouseX:0,mouseY:0,mouseHistory:[],pinchDist:0,ctrlKeyDown:!1,dblclickData:null,dblclickTimeout:null,longtouchTimeout:null,twofingersTimeout:null,ctrlZoomTimeout:null};this.keyHandler=new ki;this.resizeObserver=new ResizeObserver(fu(()=>this.viewer.autoSize(),50));this.moveThreshold=ke*f.pixelRatio}init(){window.addEventListener("keydown",this,{passive:!1});window.addEventListener("keyup",this);this.viewer.container.addEventListener("mousedown",this);window.addEventListener("mousemove",this,{passive:!1});window.addEventListener("mouseup",this);this.viewer.container.addEventListener("touchstart",this,{passive:!1});window.addEventListener("touchmove",this,{passive:!1});window.addEventListener("touchend",this,{passive:!1});this.viewer.container.addEventListener("wheel",this,{passive:!1});document.addEventListener(f.fullscreenEvent,this);this.resizeObserver.observe(this.viewer.container)}destroy(){window.removeEventListener("keydown",this);window.removeEventListener("keyup",this);this.viewer.container.removeEventListener("mousedown",this);window.removeEventListener("mousemove",this);window.removeEventListener("mouseup",this);this.viewer.container.removeEventListener("touchstart",this);window.removeEventListener("touchmove",this);window.removeEventListener("touchend",this);this.viewer.container.removeEventListener("wheel",this);document.removeEventListener(f.fullscreenEvent,this);this.resizeObserver.disconnect();clearTimeout(this.data.dblclickTimeout);clearTimeout(this.data.longtouchTimeout);clearTimeout(this.data.twofingersTimeout);clearTimeout(this.data.ctrlZoomTimeout);super.destroy()}handleEvent(n){switch(n.type){case"keydown":this.__onKeyDown(n);break;case"keyup":this.__onKeyUp();break;case"mousemove":this.__onMouseMove(n);break;case"mouseup":this.__onMouseUp(n);break;case"touchmove":this.__onTouchMove(n);break;case"touchend":this.__onTouchEnd(n);break;case f.fullscreenEvent:this.__onFullscreenChange()}if(!ru(n.target,"."+dt))switch(n.type){case"mousedown":this.__onMouseDown(n);break;case"touchstart":this.__onTouchStart(n);break;case"wheel":this.__onMouseWheel(n)}}__isStep(...n){return n.indexOf(this.data.step)!==-1}__onKeyDown(n){if((this.config.mousewheelCtrlKey&&(this.data.ctrlKeyDown=n.key===u.Control,this.data.ctrlKeyDown&&(clearTimeout(this.data.ctrlZoomTimeout),this.viewer.overlay.hide(e.CTRL_ZOOM))),this.viewer.dispatchEvent(new g(n.key)))&&this.state.keyboardEnabled){const t=this.config.keyboardActions?.[n.key];if(typeof t=="function")t(this.viewer),n.preventDefault();else if(t&&!this.keyHandler.pending){t!=="ZOOM_IN"&&t!=="ZOOM_OUT"&&this.viewer.stopAll();switch(t){case"ROTATE_UP":this.viewer.dynamics.position.roll({pitch:!1});break;case"ROTATE_DOWN":this.viewer.dynamics.position.roll({pitch:!0});break;case"ROTATE_RIGHT":this.viewer.dynamics.position.roll({yaw:!1});break;case"ROTATE_LEFT":this.viewer.dynamics.position.roll({yaw:!0});break;case"ZOOM_IN":this.viewer.dynamics.zoom.roll(!1);break;case"ZOOM_OUT":this.viewer.dynamics.zoom.roll(!0)}this.keyHandler.down();n.preventDefault()}}}__onKeyUp(){(this.data.ctrlKeyDown=!1,this.state.keyboardEnabled)&&this.keyHandler.up(()=>{this.viewer.dynamics.position.stop(),this.viewer.dynamics.zoom.stop(),this.viewer.resetIdleTimer()})}__onMouseDown(n){this.data.step=1;this.data.startMouseX=n.clientX;this.data.startMouseY=n.clientY}__onMouseUp(n){this.__isStep(1,2)&&this.__stopMove(n.clientX,n.clientY,n.target,n.button===2)}__onMouseMove(n){this.config.mousemove&&this.__isStep(1,2)&&(n.preventDefault(),this.__doMove(n.clientX,n.clientY));this.__handleObjectsEvents(n)}__onTouchStart(n){n.touches.length===1?(this.data.step=1,this.data.startMouseX=n.touches[0].clientX,this.data.startMouseY=n.touches[0].clientY,this.data.longtouchTimeout||(this.data.longtouchTimeout=setTimeout(()=>{const t=n.touches[0];this.__stopMove(t.clientX,t.clientY,t.target,!0);this.data.longtouchTimeout=null},ge))):n.touches.length===2&&(this.data.step=0,this.__cancelLongTouch(),this.config.mousemove&&(this.__cancelTwoFingersOverlay(),this.__startMoveZoom(n),n.preventDefault()))}__onTouchEnd(n){if(this.__cancelLongTouch(),this.__isStep(1,2))if(n.preventDefault(),this.__cancelTwoFingersOverlay(),n.touches.length===1)this.__stopMove(this.data.mouseX,this.data.mouseY);else if(n.touches.length===0){const t=n.changedTouches[0];this.__stopMove(t.clientX,t.clientY,t.target)}}__onTouchMove(n){if(this.__cancelLongTouch(),this.config.mousemove)if(n.touches.length===1){if(this.config.touchmoveTwoFingers)this.__isStep(1)&&!this.data.twofingersTimeout&&(this.data.twofingersTimeout=setTimeout(()=>{this.viewer.overlay.show({id:e.TWO_FINGERS,image:ic,title:this.config.lang.twoFingers})},no));else if(this.__isStep(1,2)){n.preventDefault();const t=n.touches[0];this.__doMove(t.clientX,t.clientY)}}else this.__doMoveZoom(n),this.__cancelTwoFingersOverlay()}__cancelLongTouch(){this.data.longtouchTimeout&&(clearTimeout(this.data.longtouchTimeout),this.data.longtouchTimeout=null)}__cancelTwoFingersOverlay(){this.config.touchmoveTwoFingers&&(this.data.twofingersTimeout&&(clearTimeout(this.data.twofingersTimeout),this.data.twofingersTimeout=null),this.viewer.overlay.hide(e.TWO_FINGERS))}__onMouseWheel(n){if(this.config.mousewheel){if(this.config.mousewheelCtrlKey&&!this.data.ctrlKeyDown){this.viewer.overlay.show({id:e.CTRL_ZOOM,image:rc,title:this.config.lang.ctrlZoom});clearTimeout(this.data.ctrlZoomTimeout);this.data.ctrlZoomTimeout=setTimeout(()=>this.viewer.overlay.hide(e.CTRL_ZOOM),to);return}n.preventDefault();n.stopPropagation();const t=n.deltaY/Math.abs(n.deltaY)*5*this.config.zoomSpeed;t!==0&&this.viewer.dynamics.zoom.step(-t,5)}}__onFullscreenChange(){const n=this.viewer.isFullscreenEnabled();this.config.keyboard==="fullscreen"&&(n?this.viewer.startKeyboardControl():this.viewer.stopKeyboardControl());this.viewer.dispatchEvent(new ht(n))}__resetMove(){this.data.step=0;this.data.mouseX=0;this.data.mouseY=0;this.data.startMouseX=0;this.data.startMouseY=0;this.data.mouseHistory.length=0}__startMoveZoom(n){this.viewer.stopAll();this.__resetMove();const t=uu(n);this.data.step=2,{distance:this.data.pinchDist,center:{x:this.data.mouseX,y:this.data.mouseY}}=t;this.__logMouseMove(this.data.mouseX,this.data.mouseY)}__stopMove(n,t,i,r=false){this.__isStep(2)?this.config.moveInertia?(this.__logMouseMove(n,t),this.__stopMoveInertia(n,t)):(this.__resetMove(),this.viewer.resetIdleTimer()):(this.__isStep(1)&&!this.__moveThresholdReached(n,t)&&this.__doClick(n,t,i,r),this.__resetMove(),this.viewer.resetIdleTimer())}__stopMoveInertia(n,t){const o=new br.SplineCurve(this.data.mouseHistory.map(([,n,t])=>new br.Vector2(n,t))),i=o.getTangent(1),r=this.data.mouseHistory.reduce(({total:t,prev:n},i)=>({total:n?t+tu({x:n[1],y:n[2]},{x:i[1],y:i[2]})/(i[0]-n[0]):0,prev:i}),{total:0,prev:null}).total/this.data.mouseHistory.length;if(!r){this.__resetMove();this.viewer.resetIdleTimer();return}this.data.step=3;let u=n,e=t;this.state.animation=new ti({properties:{speed:{start:r,end:0}},duration:1e3,easing:"outQuad",onTick:n=>{u+=n.speed*i.x*3*f.pixelRatio,e+=n.speed*i.y*3*f.pixelRatio,this.__applyMove(u,e)}});this.state.animation.then(n=>{this.state.animation=null,n&&(this.__resetMove(),this.viewer.resetIdleTimer())})}__doClick(n,t,i,r=false){const u=this.viewer.container.getBoundingClientRect(),f=n-u.left,e=t-u.top,o=this.viewer.renderer.getIntersections({x:f,y:e}),s=o.find(n=>n.object.userData[rt]);if(s){const h=this.viewer.dataHelper.vector3ToSphericalCoords(s.point),u={rightclick:r,target:i,clientX:n,clientY:t,viewerX:f,viewerY:e,yaw:h.yaw,pitch:h.pitch,objects:o.map(n=>n.object).filter(n=>!n.userData[rt])};try{const n=this.viewer.dataHelper.sphericalCoordsToTextureCoords(u);u.textureX=n.textureX;u.textureY=n.textureY}catch(c){u.textureX=NaN;u.textureY=NaN}this.data.dblclickTimeout?(Math.abs(this.data.dblclickData.clientX-u.clientX)<this.moveThreshold&&Math.abs(this.data.dblclickData.clientY-u.clientY)<this.moveThreshold&&this.viewer.dispatchEvent(new tr(this.data.dblclickData)),clearTimeout(this.data.dblclickTimeout),this.data.dblclickTimeout=null,this.data.dblclickData=null):(this.viewer.dispatchEvent(new nr(u)),this.data.dblclickData=ni(u),this.data.dblclickTimeout=setTimeout(()=>{this.data.dblclickTimeout=null,this.data.dblclickData=null},de))}}__handleObjectsEvents(n){if(!yo(this.state.objectsObservers)&&so(n.target,this.viewer.container)){const i=ho(this.viewer.container),r={x:n.clientX-i.x,y:n.clientY-i.y},u=this.viewer.renderer.getIntersections(r),t=(t,i,u)=>{this.viewer.dispatchEvent(new u(n,t,r,i))};for(const[n,i]of Object.entries(this.state.objectsObservers)){const r=u.find(t=>t.object.userData[n]);r?(i&&r.object!==i&&(t(i,n,ri),this.state.objectsObservers[n]=null),i?t(r.object,n,cr):(this.state.objectsObservers[n]=r.object,t(r.object,n,df))):i&&(t(i,n,ri),this.state.objectsObservers[n]=null)}}}__doMove(n,t){this.__isStep(1)&&this.__moveThresholdReached(n,t)?(this.viewer.stopAll(),this.__resetMove(),this.data.step=2,this.data.mouseX=n,this.data.mouseY=t,this.__logMouseMove(n,t)):this.__isStep(2)&&(this.__applyMove(n,t),this.__logMouseMove(n,t))}__moveThresholdReached(n,t){return Math.abs(n-this.data.startMouseX)>=this.moveThreshold||Math.abs(t-this.data.startMouseY)>=this.moveThreshold}__applyMove(n,t){const i={yaw:this.config.moveSpeed*((n-this.data.mouseX)/this.state.size.width)*br.MathUtils.degToRad(this.state.littlePlanet?90:this.state.hFov),pitch:this.config.moveSpeed*((t-this.data.mouseY)/this.state.size.height)*br.MathUtils.degToRad(this.state.littlePlanet?90:this.state.vFov)},r=this.viewer.getPosition();this.viewer.rotate({yaw:r.yaw-i.yaw,pitch:r.pitch+i.pitch});this.data.mouseX=n;this.data.mouseY=t}__doMoveZoom(n){if(this.__isStep(2)){n.preventDefault();const t=uu(n),i=(t.distance-this.data.pinchDist)/f.pixelRatio*this.config.zoomSpeed;this.viewer.zoom(this.viewer.getZoomLevel()+i);this.__doMove(t.center.x,t.center.y);this.data.pinchDist=t.distance}}__logMouseMove(n,t){const r=Date.now(),i=this.data.mouseHistory.length?this.data.mouseHistory[this.data.mouseHistory.length-1]:[0,-1,-1];i[1]===n&&i[2]===t?i[0]=r:r===i[0]?(i[1]=n,i[2]=t):this.data.mouseHistory.push([r,n,t]);let u=null;for(let n=0;n<this.data.mouseHistory.length;)this.data.mouseHistory[n][0]<r-nu?this.data.mouseHistory.splice(n,1):u&&this.data.mouseHistory[n][0]-u>nu/10?(this.data.mouseHistory.splice(0,n),n=0,u=this.data.mouseHistory[n][0]):(u=this.data.mouseHistory[n][0],n++)}},l=a(),ye=new l.Vector2,fc=class extends si{constructor(n){super(n);this.renderer=new l.WebGLRenderer({alpha:!0,antialias:!0});this.renderer.setPixelRatio(f.pixelRatio);this.renderer.outputColorSpace=l.LinearSRGBColorSpace;this.renderer.domElement.className="psv-canvas";this.scene=new l.Scene;this.camera=new l.PerspectiveCamera(50,16/9,.1,2*ot);this.mesh=this.viewer.adapter.createMesh();this.mesh.userData={[rt]:!0};this.meshContainer=new l.Group;this.meshContainer.add(this.mesh);this.scene.add(this.meshContainer);this.raycaster=new l.Raycaster;this.container=document.createElement("div");this.container.className="psv-canvas-container";this.container.style.background=this.config.canvasBackground;this.container.appendChild(this.renderer.domElement);this.viewer.container.appendChild(this.container);this.viewer.addEventListener(yt.type,this);this.viewer.addEventListener(w.type,this);this.viewer.addEventListener(lt.type,this);this.viewer.addEventListener(o.type,this);this.hide()}get panoramaPose(){return this.mesh.rotation}get sphereCorrection(){return this.meshContainer.rotation}init(){this.config.mousemove&&(this.container.style.cursor="move");this.show();this.renderer.setAnimationLoop(n=>this.__renderLoop(n))}destroy(){this.renderer.setAnimationLoop(null);this.cleanScene(this.scene);this.viewer.container.removeChild(this.container);this.viewer.removeEventListener(yt.type,this);this.viewer.removeEventListener(w.type,this);this.viewer.removeEventListener(lt.type,this);this.viewer.removeEventListener(o.type,this);super.destroy()}handleEvent(n){switch(n.type){case yt.type:this.__onSizeUpdated();break;case w.type:this.__onZoomUpdated();break;case lt.type:this.__onPositionUpdated();break;case o.type:n.containsOptions("fisheye")&&this.__onPositionUpdated();n.containsOptions("mousemove")&&(this.container.style.cursor=this.config.mousemove?"move":"default");n.containsOptions("canvasBackground")&&(this.container.style.background=this.config.canvasBackground)}}hide(){this.container.style.opacity="0"}show(){this.container.style.opacity="1"}setCustomRenderer(n){this.customRenderer=n?n(this.renderer):null;this.viewer.needsUpdate()}__onSizeUpdated(){this.renderer.setSize(this.state.size.width,this.state.size.height);this.camera.aspect=this.state.aspect;this.camera.updateProjectionMatrix();this.viewer.needsUpdate()}__onZoomUpdated(){this.camera.fov=this.state.vFov;this.camera.updateProjectionMatrix();this.viewer.needsUpdate()}__onPositionUpdated(){this.camera.position.set(0,0,0);this.camera.lookAt(this.state.direction);this.config.fisheye&&this.camera.position.copy(this.state.direction).multiplyScalar(this.config.fisheye/2).negate();this.viewer.needsUpdate()}__renderLoop(n){const t=this.timestamp?n-this.timestamp:0;this.timestamp=n;this.viewer.dispatchEvent(new di(n,t));this.viewer.dynamics.update(t);this.state.needsUpdate&&((this.customRenderer||this.renderer).render(this.scene,this.camera),this.viewer.dispatchEvent(new fr),this.state.needsUpdate=!1)}setTexture(n){this.state.panoData=n.panoData;this.viewer.adapter.setTexture(this.mesh,n);this.viewer.needsUpdate()}setOverlay(n,t){this.viewer.adapter.setOverlay(this.mesh,n,t);this.viewer.needsUpdate()}setPanoramaPose(n,t=this.mesh){const i=this.viewer.dataHelper.cleanPanoramaPose(n);t.rotation.set(-i.tilt,-i.pan,-i.roll,"ZXY")}setSphereCorrection(n,t=this.meshContainer){const i=this.viewer.dataHelper.cleanSphereCorrection(n);t.rotation.set(i.tilt,i.pan,i.roll,"ZXY")}transition(n,t){const u=vi(t),f="zoom"in t,r=new l.Group,i=this.viewer.adapter.createMesh(.5);if(this.viewer.adapter.setTexture(i,n,!0),this.viewer.adapter.setTextureOpacity(i,0),this.setPanoramaPose(n.panoData,i),this.setSphereCorrection(t.sphereCorrection,r),u){const n=this.viewer.dataHelper.cleanPosition(t),i=this.viewer.getPosition(),u=new l.Vector3(0,1,0);r.rotateOnWorldAxis(u,n.yaw-i.yaw);const f=new l.Vector3(0,1,0).cross(this.camera.getWorldDirection(new l.Vector3)).normalize();r.rotateOnWorldAxis(f,n.pitch-i.pitch)}r.add(i);this.scene.add(r);this.renderer.setRenderTarget(new l.WebGLRenderTarget);this.renderer.render(this.scene,this.camera);this.renderer.setRenderTarget(null);const e=new ti({properties:{opacity:{start:0,end:1},zoom:f?{start:this.viewer.getZoomLevel(),end:t.zoom}:void 0},duration:t.transition,easing:"outCubic",onTick:n=>{this.viewer.adapter.setTextureOpacity(i,n.opacity),this.viewer.adapter.setTextureOpacity(this.mesh,1-n.opacity),f&&this.viewer.zoom(n.zoom),this.viewer.needsUpdate()}});return e.then(f=>{f?(this.setTexture(n),this.viewer.adapter.setTextureOpacity(this.mesh,1),this.setPanoramaPose(n.panoData),this.setSphereCorrection(t.sphereCorrection),u&&this.viewer.rotate(t)):this.viewer.adapter.disposeTexture(n),this.scene.remove(r),i.geometry.dispose(),i.geometry=null}),e}getIntersections(n){return ye.x=2*n.x/this.state.size.width-1,ye.y=-2*n.y/this.state.size.height+1,this.raycaster.setFromCamera(ye,this.camera),this.raycaster.intersectObjects(this.scene.children,!0).filter(n=>n.object.isMesh&&!!n.object.userData)}addObject(n){this.scene.add(n)}removeObject(n){this.scene.remove(n)}cleanScene(n){n.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(n=>{n.map&&n.map.dispose(),n.dispose()}):(t.material.map&&t.material.map.dispose(),t.material.dispose())),!t.dispose||t instanceof l.Scene||t.dispose(),t!==n&&this.cleanScene(t)})}},ec=a(),oc=class extends si{constructor(n){super(n);this.loader=new ec.FileLoader;this.loader.setResponseType("blob");this.config.withCredentials&&this.loader.setWithCredentials(!0)}destroy(){this.abortLoading();super.destroy()}abortLoading(){}loadFile(n,t){return this.config.requestHeaders&&this.loader.setRequestHeader(this.config.requestHeaders(n)),new Promise((i,r)=>{let u=0;t?.(u);this.loader.load(n,n=>{u=100,t?.(u),i(n)},n=>{if(n.lengthComputable){const i=n.loaded/n.total*100;i>u&&(u=i,t?.(u))}},n=>{r(n)})})}loadImage(n,t){return this.loadFile(n,t).then(n=>this.blobToImage(n))}blobToImage(n){return new Promise((t,i)=>{const r=document.createElement("img");r.onload=()=>{URL.revokeObjectURL(r.src),t(r)};r.onerror=i;r.src=URL.createObjectURL(n)})}preloadPanorama(n){return this.viewer.adapter.supportsPreload(n)?this.viewer.adapter.loadTexture(n):Promise.reject(new i("Current adapter does not support preload"))}},sc=a(),hc=class extends si{constructor(n){super(n);this.zoom=new bi(n=>{this.viewer.state.vFov=this.viewer.dataHelper.zoomLevelToFov(n),this.viewer.state.hFov=this.viewer.dataHelper.vFovToHFov(this.viewer.state.vFov),this.viewer.dispatchEvent(new w(n))},{defaultValue:this.viewer.config.defaultZoomLvl,min:0,max:100,wrap:!1});this.position=new rs(n=>{this.viewer.dataHelper.sphericalCoordsToVector3(n,this.viewer.state.direction),this.viewer.dispatchEvent(new lt(n))},{yaw:new bi(null,{defaultValue:this.config.defaultYaw,min:0,max:2*Math.PI,wrap:!0}),pitch:new bi(null,{defaultValue:this.config.defaultPitch,min:this.viewer.state.littlePlanet?0:-Math.PI/2,max:this.viewer.state.littlePlanet?Math.PI*2:Math.PI/2,wrap:this.viewer.state.littlePlanet})});this.updateSpeeds()}updateSpeeds(){this.zoom.setSpeed(this.config.zoomSpeed*50);this.position.setSpeed(sc.MathUtils.degToRad(this.config.moveSpeed*50))}update(n){this.zoom.update(n);this.position.update(n)}},cc=a(),lc=class{constructor(){this.ready=!1;this.needsUpdate=!1;this.keyboardEnabled=!1;this.direction=new cc.Vector3(0,0,ot);this.vFov=60;this.hFov=60;this.aspect=1;this.animation=null;this.transitionAnimation=null;this.loadingPromise=null;this.littlePlanet=!1;this.idleTime=-1;this.objectsObservers={};this.size={width:0,height:0};this.panoData={fullWidth:0,fullHeight:0,croppedWidth:0,croppedHeight:0,croppedX:0,croppedY:0,poseHeading:0,posePitch:0,poseRoll:0}}},ac=class extends ss{constructor(n){super();this.plugins={};this.children=[];this.onResize=fu(()=>this.navbar.autoSize(),500);f.load();this.state=new lc;this.config=vh(n);this.parent=oo(n.container);this.parent[rt]=this;this.container=document.createElement("div");this.container.classList.add("psv-container");this.parent.appendChild(this.container);this.adapter=new this.config.adapter[0](this,this.config.adapter[1]);this.renderer=new fc(this);this.textureLoader=new oc(this);this.eventsHandler=new uc(this);this.dataHelper=new tc(this);this.dynamics=new hc(this);this.loader=new ph(this);this.navbar=new yh(this);this.panel=new dh(this);this.notification=new wh(this);this.overlay=new bh(this);this.resize(this.config.size);ou(f.isTouchEnabled,n=>{li(this.container,"psv--is-touch",n)});this.config.plugins.forEach(([t,n])=>{this.plugins[t.id]=new t(this,n)});for(const n of Object.values(this.plugins))n.init?.();this.config.navbar&&this.navbar.setButtons(this.config.navbar);this.config.panorama?this.setPanorama(this.config.panorama):this.loader.show()}destroy(){this.stopAll();this.stopKeyboardControl();this.exitFullscreen();for(const[n,t]of Object.entries(this.plugins))t.destroy(),delete this.plugins[n];this.children.slice().forEach(n=>n.destroy());this.children.length=0;this.eventsHandler.destroy();this.renderer.destroy();this.textureLoader.destroy();this.dataHelper.destroy();this.adapter.destroy();this.dynamics.destroy();this.parent.removeChild(this.container);delete this.parent[rt]}init(){this.eventsHandler.init();this.renderer.init();this.config.navbar&&(this.container.classList.add("psv--has-navbar"),this.navbar.show());this.config.keyboard==="always"&&this.startKeyboardControl();this.resetIdleTimer();this.state.ready=!0;this.dispatchEvent(new at)}resetIdleTimer(){this.state.idleTime=performance.now()}disableIdleTimer(){this.state.idleTime=-1}getPlugin(n){if(typeof n=="string")return this.plugins[n];else{const t=le(n);return t?this.plugins[t.id]:null}}getPosition(){return this.dataHelper.cleanPosition(this.dynamics.position.current)}getZoomLevel(){return this.dynamics.zoom.current}getSize(){return{...this.state.size}}isFullscreenEnabled(){return co(this.container)}needsUpdate(){this.state.needsUpdate=!0}autoSize(){(this.container.clientWidth!==this.state.size.width||this.container.clientHeight!==this.state.size.height)&&(this.state.size.width=Math.round(this.container.clientWidth),this.state.size.height=Math.round(this.container.clientHeight),this.state.aspect=this.state.size.width/this.state.size.height,this.state.hFov=this.dataHelper.vFovToHFov(this.state.vFov),this.dispatchEvent(new yt(this.getSize())),this.onResize())}setPanorama(n,t={}){this.textureLoader.abortLoading();this.state.transitionAnimation?.cancel();this.state.ready||["sphereCorrection","panoData","overlay","overlayOpacity"].forEach(n=>{n in t||(t[n]=this.config[n])});(t.transition===void 0||t.transition===!0)&&(t.transition=we);t.showLoader===void 0&&(t.showLoader=!0);t.caption===void 0&&(t.caption=this.config.caption);t.description===void 0&&(t.description=this.config.description);t.panoData||typeof this.config.panoData!="function"||(t.panoData=this.config.panoData);const r=vi(t),u="zoom"in t;(r||u)&&this.stopAll();this.hideError();this.resetIdleTimer();this.config.panorama=n;this.config.caption=t.caption;this.config.description=t.description;const i=n=>{if(this.loader.hide(),this.state.loadingPromise=null,ko(n))return!1;if(n){this.navbar.setCaption("");this.showError(this.config.lang.loadError);console.error(n);throw n;}else return this.setOverlay(t.overlay,t.overlayOpacity),this.navbar.setCaption(this.config.caption),!0};this.navbar.setCaption(`<em>${this.config.loadingTxt||""}</em>`);(t.showLoader||!this.state.ready)&&this.loader.show();const f=this.adapter.loadTexture(this.config.panorama,t.panoData).then(n=>{if(n.panorama!==this.config.panorama){this.adapter.disposeTexture(n);throw su();}return n});return this.state.loadingPromise=t.transition&&this.state.ready&&this.adapter.supportsTransition(this.config.panorama)?f.then(n=>(this.loader.hide(),this.dispatchEvent(new ii(n)),this.state.transitionAnimation=this.renderer.transition(n,t),this.state.transitionAnimation)).then(n=>{if(this.state.transitionAnimation=null,!n)throw su();}).then(()=>i(),n=>i(n)):f.then(n=>{this.renderer.show(),this.renderer.setTexture(n),this.renderer.setPanoramaPose(n.panoData),this.renderer.setSphereCorrection(t.sphereCorrection),this.state.ready||this.init(),this.dispatchEvent(new ii(n)),u&&this.zoom(t.zoom),r&&this.rotate(t)}).then(()=>i(),n=>i(n)),this.state.loadingPromise}setOverlay(n,t=this.config.overlayOpacity){const r=this.adapter.constructor.supportsOverlay;return n?r?this.adapter.loadTexture(n,n=>{const t=this.state.panoData,i=n.width/t.croppedWidth;return{fullWidth:i*t.fullWidth,fullHeight:i*t.fullHeight,croppedWidth:i*t.croppedWidth,croppedHeight:i*t.croppedHeight,croppedX:i*t.croppedX,croppedY:i*t.croppedY}},!1).then(n=>{this.renderer.setOverlay(n,t)}):Promise.reject(new i(`Current adapter does not supports overlay`)):(r&&this.renderer.setOverlay(null,0),Promise.resolve())}setOptions(n){const t={...this.config,...n};for(let[i,r]of Object.entries(n)){if(!(i in pt)){s(`Unknown option ${i}`);continue}if(i in ys){s(ys[i]);continue}i in ae&&(r=ae[i](r,{rawConfig:t,defValue:pt[i]}));this.config[i]=r;switch(i){case"caption":this.navbar.setCaption(this.config.caption);break;case"size":this.resize(this.config.size);break;case"sphereCorrection":this.renderer.setSphereCorrection(this.config.sphereCorrection);break;case"navbar":case"lang":this.navbar.setButtons(this.config.navbar);break;case"moveSpeed":case"zoomSpeed":this.dynamics.updateSpeeds();break;case"minFov":case"maxFov":this.dynamics.zoom.setValue(this.dataHelper.fovToZoomLevel(this.state.vFov));this.dispatchEvent(new w(this.getZoomLevel()));break;case"keyboard":this.config.keyboard==="always"?this.startKeyboardControl():this.stopKeyboardControl()}}this.needsUpdate();this.dispatchEvent(new o(Object.keys(n)))}setOption(n,t){this.setOptions({[n]:t})}showError(n){this.overlay.show({id:e.ERROR,image:nc,title:n,dissmisable:!1})}hideError(){this.overlay.hide(e.ERROR)}rotate(n){const t=new gi(this.dataHelper.cleanPosition(n));(this.dispatchEvent(t),t.defaultPrevented)||this.dynamics.position.setValue(t.position)}zoom(n){this.dynamics.zoom.setValue(n)}zoomIn(n=1){this.dynamics.zoom.step(n)}zoomOut(n=1){this.dynamics.zoom.step(-n)}animate(n){const i=vi(n),e=n.zoom!==void 0,r=new yu(i?this.dataHelper.cleanPosition(n):void 0,n.zoom);if(this.dispatchEvent(r),!r.defaultPrevented){const u=r.position,o=r.zoomLevel;this.stopAll();const f={};let t;if(i){const i=this.getPosition(),r=fo(i.yaw,u.yaw);f.yaw={start:i.yaw,end:i.yaw+r};f.pitch={start:i.pitch,end:u.pitch};t=this.dataHelper.speedToDuration(n.speed,eo(i,u))}if(e){const i=Math.abs(o-this.getZoomLevel());f.zoom={start:this.getZoomLevel(),end:o};t||(t=this.dataHelper.speedToDuration(n.speed,Math.PI/4*i/100))}return t?(this.state.animation=new ti({properties:f,duration:Math.max(be,t),easing:"inOutSine",onTick:n=>{i&&this.dynamics.position.setValue({yaw:n.yaw,pitch:n.pitch}),e&&this.dynamics.zoom.setValue(n.zoom)}}),this.state.animation.then(()=>{this.state.animation=null,this.resetIdleTimer()}),this.state.animation):(i&&this.rotate(u),e&&this.zoom(o),new ti(null))}}stopAnimation(){return this.state.animation?(this.state.animation.cancel(),this.state.animation):Promise.resolve()}resize(n){const t=n;["width","height"].forEach(i=>{n&&t[i]&&(/^[0-9.]+$/.test(t[i])&&(t[i]+="px"),this.parent.style[i]=t[i])});this.autoSize()}enterFullscreen(){this.isFullscreenEnabled()||lo(this.container)}exitFullscreen(){this.isFullscreenEnabled()&&ao()}toggleFullscreen(){this.isFullscreenEnabled()?this.exitFullscreen():this.enterFullscreen()}startKeyboardControl(){this.state.keyboardEnabled=!0}stopKeyboardControl(){this.state.keyboardEnabled=!1}createTooltip(n){return new gh(this,n)}observeObjects(n){this.state.objectsObservers[n]=null}unobserveObjects(n){delete this.state.objectsObservers[n]}stopAll(){return this.dispatchEvent(new sr),this.disableIdleTimer(),this.stopAnimation()}};dr.Cache.enabled=!0;dr.ColorManagement.enabled=!1;ds(kr(n,"__esModule",{value:!0}),pe)});