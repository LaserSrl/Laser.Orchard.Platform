{"version":3,"file":"upload-dragdrop.js","sources":["../../src/js/plugins/upload-dragdrop.js"],"sourcesContent":["import BaseComponent from 'bootstrap/js/src/base-component.js'\r\n\r\nimport EventHandler from 'bootstrap/js/src/dom/event-handler'\r\nimport SelectorEngine from 'bootstrap/js/src/dom/selector-engine'\r\n\r\nimport ProgressDonut from './progress-donut'\r\n\r\nconst NAME = 'upload'\r\nconst DATA_KEY = 'bs.upload'\r\nconst EVENT_KEY = `.${DATA_KEY}`\r\nconst DATA_API_KEY = '.data-api'\r\n\r\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\r\n\r\nconst EVENT_DRAG = `drag`\r\nconst EVENT_DRAG_START = `dragstart`\r\nconst EVENT_DRAG_END = `dragend`\r\nconst EVENT_DRAG_OVER = `dragover`\r\nconst EVENT_DRAG_ENTER = `dragenter`\r\nconst EVENT_DRAG_LEAVE = `dragleave`\r\nconst EVENT_DROP = `drop`\r\n\r\nconst CLASS_NAME_SUCCESS = 'success'\r\nconst CLASS_NAME_DRAGOVER = 'dragover'\r\nconst CLASS_NAME_LOADING = 'loading'\r\n\r\nconst SELECTOR_FORM = '[data-bs-upload-dragdrop]'\r\nconst SELECTOR_DONUT = '[data-bs-progress-donut]'\r\n\r\nclass UploadDragDrop extends BaseComponent {\r\n  constructor(element) {\r\n    super(element)\r\n\r\n    const donutElement = SelectorEngine.findOne(SELECTOR_DONUT, this._element)\r\n    if (donutElement) {\r\n      this._donut = ProgressDonut.getOrCreateInstance(donutElement)\r\n    }\r\n\r\n    this._bindEvents()\r\n  }\r\n\r\n  // Getters\r\n\r\n  static get NAME() {\r\n    return NAME\r\n  }\r\n\r\n  // Public\r\n  progress(value) {\r\n    this._donut.set(value)\r\n  }\r\n\r\n  start() {\r\n    this.reset()\r\n    this._element.classList.add(CLASS_NAME_LOADING)\r\n  }\r\n\r\n  success() {\r\n    this._element.classList.remove(CLASS_NAME_LOADING)\r\n    this._element.classList.add(CLASS_NAME_SUCCESS)\r\n  }\r\n\r\n  reset() {\r\n    this._element.classList.remove(CLASS_NAME_LOADING)\r\n    this._element.classList.remove(CLASS_NAME_SUCCESS)\r\n    this._donut.set(0)\r\n  }\r\n\r\n  dispose() {\r\n    this._donut.dispose()\r\n\r\n    super.dispose()\r\n  }\r\n\r\n  // Private\r\n  _bindEvents() {\r\n    EventHandler.on(this._element, EVENT_DRAG, (evt) => this._preventEvent(evt))\r\n    EventHandler.on(this._element, EVENT_DRAG_START, (evt) => this._preventEvent(evt))\r\n    EventHandler.on(this._element, EVENT_DRAG_END, (evt) => this._preventEvent(evt))\r\n    EventHandler.on(this._element, EVENT_DRAG_OVER, (evt) => this._preventEvent(evt))\r\n    EventHandler.on(this._element, EVENT_DRAG_ENTER, (evt) => this._preventEvent(evt))\r\n    EventHandler.on(this._element, EVENT_DRAG_LEAVE, (evt) => this._preventEvent(evt))\r\n    EventHandler.on(this._element, EVENT_DROP, (evt) => this._preventEvent(evt))\r\n\r\n    EventHandler.on(this._element, EVENT_DRAG_OVER, () => this._dropIn())\r\n    EventHandler.on(this._element, EVENT_DRAG_ENTER, () => this._dropIn())\r\n    EventHandler.on(this._element, EVENT_DRAG_LEAVE, () => this._dropOut())\r\n    EventHandler.on(this._element, EVENT_DRAG_END, () => this._dropOut())\r\n    EventHandler.on(this._element, EVENT_DROP, () => this._dropOut())\r\n\r\n    EventHandler.on(this._element, EVENT_DROP, () => this._drop())\r\n  }\r\n  _preventEvent(evt) {\r\n    evt.preventDefault()\r\n    evt.stopPropagation()\r\n  }\r\n\r\n  _dropIn() {\r\n    if (!this._isSuccess()) {\r\n      this._element.classList.add(CLASS_NAME_DRAGOVER)\r\n    }\r\n  }\r\n  _dropOut() {\r\n    if (!this._isSuccess()) {\r\n      this._element.classList.remove(CLASS_NAME_DRAGOVER)\r\n    }\r\n  }\r\n  _drop() {\r\n    if (!this._isSuccess()) {\r\n      this.start()\r\n    }\r\n  }\r\n\r\n  _isSuccess() {\r\n    return this._element.classList.contains(CLASS_NAME_SUCCESS)\r\n  }\r\n}\r\n\r\n/**\r\n * ------------------------------------------------------------------------\r\n * Data Api implementation\r\n * ------------------------------------------------------------------------\r\n */\r\n\r\n/*SelectorEngine.find(SELECTOR_FORM).forEach((form) => {\r\n  UploadDragDrop.getOrCreateInstance(form)\r\n})*/\r\n\r\nconst createInput = (element) => {\r\n  let found = element.matches && element.matches(SELECTOR_FORM) ? element : element.closest ? element.closest(SELECTOR_FORM) : null\r\n  if (found) {\r\n    UploadDragDrop.getOrCreateInstance(found)\r\n  }\r\n  return null\r\n}\r\n\r\ndocument.addEventListener('dragenter', function (evt) {\r\n  createInput(evt.target)\r\n})\r\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_FORM + ' label', function () {\r\n  createInput(this)\r\n})\r\n\r\nexport default UploadDragDrop\r\n"],"names":[],"mappings":"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"}