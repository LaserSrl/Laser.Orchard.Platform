{"version":3,"file":"input-search-autocomplete.js","sources":["../../src/js/plugins/input-search-autocomplete.js"],"sourcesContent":["//import BaseComponent from 'bootstrap/js/src/base-component.js'\r\n\r\nimport BaseComponent from 'bootstrap/js/src/base-component'\r\nimport EventHandler from 'bootstrap/js/src/dom/event-handler'\r\n//import SelectorEngine from 'bootstrap/js/src/dom/selector-engine'\r\n\r\nimport InputLabel from './input-label'\r\n\r\nconst NAME = 'inputsearchautocomplete'\r\nconst DATA_KEY = 'bs.inputsearchautocomplete'\r\nconst EVENT_KEY = `.${DATA_KEY}`\r\nconst DATA_API_KEY = '.data-api'\r\n\r\nconst Default = {\r\n  autocomplete: [],\r\n}\r\n\r\nconst EVENT_KEYUP = `keyup${EVENT_KEY}`\r\nconst EVENT_KEYUP_DATA_API = `keyup${EVENT_KEY}${DATA_API_KEY}`\r\nconst EVENT_MOUSEDOWN_DATA_API = `mousedown${EVENT_KEY}${DATA_API_KEY}`\r\n\r\nconst CLASS_NAME_SHOW = 'autocomplete-list-show'\r\nconst CLASS_NAME_AUTOCOMPLETE = 'autocomplete'\r\n\r\nconst DATA_AUTOCOMPLETE = 'data-bs-autocomplete'\r\n\r\nconst SELECTOR_SEARCH = 'input[' + DATA_AUTOCOMPLETE + '][type=\"search\"]'\r\n\r\nclass InputSearch extends BaseComponent {\r\n  constructor(element, config) {\r\n    super(element)\r\n\r\n    this._config = this._getConfig(config)\r\n    this._items = []\r\n    this._autocompleteElement = null\r\n\r\n    this._label = new InputLabel(element)\r\n\r\n    this._init()\r\n    this._bindEvents()\r\n  }\r\n\r\n  // Getters\r\n\r\n  static get NAME() {\r\n    return NAME\r\n  }\r\n\r\n  // Public\r\n  search() {\r\n    const value = this._element.value\r\n\r\n    //!!! $autocomplete.empty()\r\n    this._autocompleteElement.innerHTML = ''\r\n\r\n    if (value) {\r\n      this._items.forEach((item) => {\r\n        let markText = new RegExp('(' + value + ')', 'gi')\r\n        let optionText = item.text.replace(markText, '<mark>$1</mark>')\r\n        let optionLabel = item.label ? '<em>' + item.label + '</em>' : ''\r\n        let optionIcon = item.icon ? item.icon : ''\r\n        let optionLink = item.link ? item.link : '#'\r\n\r\n        if (optionText.toLowerCase().indexOf(value.toLowerCase()) !== -1) {\r\n          this._autocompleteElement.classList.add(CLASS_NAME_SHOW)\r\n          this._autocompleteElement.appendChild(this._createOption(optionLink, optionText, optionLabel, optionIcon))\r\n        }\r\n      })\r\n    } else {\r\n      this._autocompleteElement.classList.remove(CLASS_NAME_SHOW)\r\n    }\r\n  }\r\n\r\n  // Private\r\n  _getConfig(config) {\r\n    config = {\r\n      ...Default,\r\n      ...(typeof config === 'object' ? config : {}),\r\n    }\r\n    return config\r\n  }\r\n\r\n  _getItems() {\r\n    try {\r\n      return JSON.parse(this._element.getAttribute(DATA_AUTOCOMPLETE))\r\n    } catch (error) {\r\n      console.error('[InputSearchAutocomplete] invalid data provided for ' + DATA_AUTOCOMPLETE + ' attribute', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  _init() {\r\n    if (this._element.classList.contains(CLASS_NAME_AUTOCOMPLETE)) {\r\n      this._items = this._getItems()\r\n      this._autocompleteElement = document.createElement('ul')\r\n      this._autocompleteElement.classList.add('autocomplete-list')\r\n      this._element.parentNode.insertBefore(this._autocompleteElement, this._element.nextSibling)\r\n    }\r\n  }\r\n\r\n  _bindEvents() {\r\n    EventHandler.on(this._element, EVENT_KEYUP, () => this.search())\r\n  }\r\n\r\n  _createOption(link, text, label, icon) {\r\n    const option = document.createElement('li')\r\n    option.innerHTML = `<a href=\"${link}\">\r\n        ${icon}\r\n        <span class=\"autocomplete-list-text\">\r\n          <span>${text}</span>\r\n          ${label}\r\n        </span>\r\n      </a>`\r\n\r\n    return option\r\n  }\r\n}\r\n\r\n/**\r\n * ------------------------------------------------------------------------\r\n * Data Api implementation\r\n * ------------------------------------------------------------------------\r\n */\r\n\r\n/*const inputs = SelectorEngine.find(SELECTOR_SEARCH)\r\ninputs.forEach((input) => {\r\n  EventHandler.one(input, EVENT_KEYUP_DATA_API, () => {\r\n    const searchInput = InputSearch.getOrCreateInstance(input)\r\n    searchInput.search()\r\n  })\r\n})*/\r\n\r\nconst createInput = (element) => {\r\n  if (element && element.matches(SELECTOR_SEARCH)) {\r\n    return InputSearch.getOrCreateInstance(element)\r\n  }\r\n  return null\r\n}\r\n\r\nEventHandler.on(document, EVENT_MOUSEDOWN_DATA_API, SELECTOR_SEARCH + ', label', function () {\r\n  const target = InputLabel.getInputFromLabel(this) || this\r\n  createInput(target)\r\n})\r\nEventHandler.on(document, EVENT_KEYUP_DATA_API, SELECTOR_SEARCH + ', label', function () {\r\n  const target = InputLabel.getInputFromLabel(this) || this\r\n  const element = createInput(target)\r\n  if (element && element._label) {\r\n    element._label._labelOut()\r\n  }\r\n})\r\n\r\nexport default InputSearch\r\n"],"names":[],"mappings":"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"}