{"version":3,"file":"form-validate.js","sources":["../../src/js/plugins/form-validate.js"],"sourcesContent":["import JustValidate from 'just-validate'\r\nimport { CssClassObserver, ContentObserver } from './util/observer'\r\n\r\nconst CONFIG_DEFAULT = {\r\n  errorFieldCssClass: 'is-invalid',\r\n  errorLabelCssClass: 'just-validate-error-label',\r\n}\r\n\r\nconst NAME = 'justvalidatebi'\r\n\r\nconst CLASS_NAME_SRONLY = 'sr-only-justvalidate-bi'\r\n\r\nconst SELECTOR_SPAN_SRONLY = `.${CLASS_NAME_SRONLY}`\r\n\r\nclass FormValidate {\r\n  constructor(selector, config) {\r\n    this.formSelector = selector\r\n    this.target = document.querySelector(selector)\r\n    this.validate = new JustValidate(selector, config)\r\n    this.config = Object.assign({}, CONFIG_DEFAULT, this.validate.globalConfig)\r\n    this.formItems = []\r\n\r\n    this.init()\r\n\r\n    return this.validate\r\n  }\r\n\r\n  init() {\r\n    const inputs = this.target.querySelectorAll('input, select')\r\n    inputs.forEach((input) => {\r\n      const watcher = new CssClassObserver(\r\n        input,\r\n        this.config.errorFieldCssClass,\r\n        () => this.onInputError(input),\r\n        () => this.onInputErrorRemove(input),\r\n        true\r\n      )\r\n      if (!input.id) {\r\n        input.setAttribute('id', NAME + '-input-' + Math.random())\r\n      }\r\n      this.formItems.push({\r\n        item: input,\r\n        watcher,\r\n      })\r\n    })\r\n    const fieldsets = this.target.querySelectorAll('fieldset')\r\n    fieldsets.forEach((field) => {\r\n      const inputs = field.querySelectorAll('input[type=radio],input[type=checkbox]')\r\n      if (inputs.length > 0) {\r\n        const watcher = new ContentObserver(\r\n          field,\r\n          '.' + this.config.errorLabelCssClass,\r\n          () => this.onFieldsetError(field),\r\n          () => this.onFieldsetErrorRemove(field)\r\n        )\r\n        if (!field.id) {\r\n          field.setAttribute('id', NAME + '-fieldset-' + Math.random())\r\n        }\r\n        this.formItems.push({\r\n          item: field,\r\n          watcher,\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Adds ARIA attributes to the input and to the error message\r\n   * @param {Object} target - the input element\r\n   */\r\n  onInputError(target) {\r\n    const errElements = this.getErrorMessages(target)\r\n    const errIds = []\r\n    errElements.forEach((el, idx) => {\r\n      const id = target.id + '-error-' + idx\r\n      el.setAttribute('id', id)\r\n      errIds.push(id)\r\n    })\r\n\r\n    if (errIds.length > 0) {\r\n      target.setAttribute('aria-describedby', errIds.join(' '))\r\n      target.setAttribute('aria-invalid', 'true')\r\n    } /*else {\r\n      console.warn('[JustValidateIt] the element is invalid but no error message was found', { target })\r\n    }*/\r\n  }\r\n  /**\r\n   * Removes input ARIA attributes\r\n   * @param {Object} target - the input element\r\n   */\r\n  onInputErrorRemove(target) {\r\n    target.removeAttribute('aria-describedby')\r\n    target.setAttribute('aria-invalid', 'false')\r\n  }\r\n  /**\r\n   * Adds ARIA attributes to the fieldset and to the error message\r\n   * @param {Object} target - the fieldset element\r\n   */\r\n  onFieldsetError(target) {\r\n    const errElements = this.getErrorMessages(target)\r\n    const errIds = []\r\n    const errTexts = []\r\n    errElements.forEach((el, idx) => {\r\n      const id = target.id + '-error-' + idx\r\n      el.setAttribute('id', id)\r\n      errIds.push(id)\r\n      errTexts.push(el.textContent)\r\n    })\r\n\r\n    if (errIds.length > 0) {\r\n      const legend = target.querySelector('legend')\r\n      if (legend) {\r\n        legend.setAttribute('aria-describedby', errIds.join(' '))\r\n        legend.setAttribute('aria-invalid', 'true')\r\n\r\n        //not needed anymore\r\n        /*const span = document.createElement('span')\r\n        span.classList.add('sr-only')\r\n        span.classList.add(CLASS_NAME_SRONLY)\r\n        span.textContent = errTexts.join(' ')\r\n        legend.append(span)*/\r\n      }\r\n    } /*else {\r\n      console.warn('[JustValidateIt] the element is invalid but no error message was found', { target })\r\n    }*/\r\n  }\r\n  /**\r\n   * Removes the fieldset ARIA attributes\r\n   * @param {Object} target - the fieldset element\r\n   */\r\n  onFieldsetErrorRemove(target) {\r\n    const legend = target.querySelector('legend')\r\n    if (legend) {\r\n      legend.removeAttribute('aria-describedby')\r\n      legend.setAttribute('aria-invalid', 'false')\r\n      const span = legend.querySelector(SELECTOR_SPAN_SRONLY)\r\n      if (span) {\r\n        span.remove()\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * get the error messages for the target\r\n   * @param {Object} target - target node\r\n   */\r\n  getErrorMessages(target) {\r\n    let parent = target\r\n    let messages = parent.querySelectorAll('.' + this.config.errorLabelCssClass)\r\n    while (parent != null && messages.length === 0) {\r\n      parent = parent.parentNode\r\n      messages = parent.querySelectorAll('.' + this.config.errorLabelCssClass)\r\n    }\r\n    return messages\r\n  }\r\n}\r\n\r\n//Plugins\r\n/**\r\n * Validate a custom autocomplete select\r\n * @param {string} inputId - the input id\r\n * @param {Object} config - { required }\r\n */\r\nconst ValidatorSelectAutocomplete = (inputId, config = {}) => {\r\n  return (value, fields) => {\r\n    let result = false\r\n    const field = fields[inputId]\r\n    if (field) {\r\n      if (!config.required && !value) {\r\n        result = true\r\n      } else {\r\n        document\r\n          .querySelector('#' + field.elem.id + '-select')\r\n          .querySelectorAll('option')\r\n          .forEach((option) => {\r\n            if (option.text === value) {\r\n              result = true\r\n            }\r\n          })\r\n      }\r\n    } else {\r\n      throw new Error('ValidatorSelectAutocomplete: ' + inputId + ' not found as form field')\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n\r\n//window.JustValidateIt = JustValidateIt\r\n//window.JustValidateItValidatorSelectAutocomplete = JustValidateItValidatorSelectAutocomplete\r\n\r\nexport { FormValidate, ValidatorSelectAutocomplete }\r\n"],"names":[],"mappings":"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"}